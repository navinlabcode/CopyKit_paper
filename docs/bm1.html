<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 BM1 | _main.knit</title>
  <meta name="description" content="<p>This is the code from the figures presented in the CopyKit manuscript -
Resolving clonal substructure from single cell genomic data using CopyKit.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="3 BM1 | _main.knit" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>This is the code from the figures presented in the CopyKit manuscript -
Resolving clonal substructure from single cell genomic data using CopyKit.</p>" />
  <meta name="github-repo" content="navinlabcode/copykit" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 BM1 | _main.knit" />
  
  <meta name="twitter:description" content="<p>This is the code from the figures presented in the CopyKit manuscript -
Resolving clonal substructure from single cell genomic data using CopyKit.</p>" />
  

<meta name="author" content="Darlan Conterno Minussi" />


<meta name="date" content="2022-03-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bl1-and-bl2.html"/>
<link rel="next" href="cm1-and-cm2.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CopyKit Manuscript Code</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html"><i class="fa fa-check"></i><b>2</b> BL1 and BL2</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#bl1"><i class="fa fa-check"></i><b>2.1</b> BL1</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#filtering"><i class="fa fa-check"></i><b>2.1.1</b> Filtering</a></li>
<li class="chapter" data-level="2.1.2" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#umap-and-clustering"><i class="fa fa-check"></i><b>2.1.2</b> UMAP and clustering</a></li>
<li class="chapter" data-level="2.1.3" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#subclones-heatmap"><i class="fa fa-check"></i><b>2.1.3</b> Subclones Heatmap</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#bl2"><i class="fa fa-check"></i><b>2.2</b> BL2</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#filtering-1"><i class="fa fa-check"></i><b>2.2.1</b> Filtering</a></li>
<li class="chapter" data-level="2.2.2" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#umap-and-clustering-1"><i class="fa fa-check"></i><b>2.2.2</b> UMAP and clustering</a></li>
<li class="chapter" data-level="2.2.3" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#subclones-heatmap-1"><i class="fa fa-check"></i><b>2.2.3</b> Subclones Heatmap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bm1.html"><a href="bm1.html"><i class="fa fa-check"></i><b>3</b> BM1</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bm1.html"><a href="bm1.html#reading-datasets"><i class="fa fa-check"></i><b>3.1</b> Reading datasets</a></li>
<li class="chapter" data-level="3.2" data-path="bm1.html"><a href="bm1.html#running-umap-and-clustering"><i class="fa fa-check"></i><b>3.2</b> Running UMAP and Clustering</a></li>
<li class="chapter" data-level="3.3" data-path="bm1.html"><a href="bm1.html#consensus-tree"><i class="fa fa-check"></i><b>3.3</b> Consensus tree</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html"><i class="fa fa-check"></i><b>4</b> CM1 and CM2</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm1"><i class="fa fa-check"></i><b>4.1</b> CM1</a></li>
<li class="chapter" data-level="4.2" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm1-colon"><i class="fa fa-check"></i><b>4.2</b> CM1 colon</a></li>
<li class="chapter" data-level="4.3" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm1-liver"><i class="fa fa-check"></i><b>4.3</b> CM1 liver</a></li>
<li class="chapter" data-level="4.4" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm1-merging"><i class="fa fa-check"></i><b>4.4</b> CM1 merging</a></li>
<li class="chapter" data-level="4.5" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm2"><i class="fa fa-check"></i><b>4.5</b> CM2</a></li>
<li class="chapter" data-level="4.6" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm2-colon"><i class="fa fa-check"></i><b>4.6</b> CM2 colon</a></li>
<li class="chapter" data-level="4.7" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm2-liver"><i class="fa fa-check"></i><b>4.7</b> CM2 liver</a></li>
<li class="chapter" data-level="4.8" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm2-merging"><i class="fa fa-check"></i><b>4.8</b> CM2 merging</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="session-info.html"><a href="session-info.html"><i class="fa fa-check"></i><b>5</b> Session Info</a>
<ul>
<li class="chapter" data-level="5.1" data-path="session-info.html"><a href="session-info.html#dockerfile"><i class="fa fa-check"></i><b>5.1</b> Dockerfile</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="copykit-paper.html"><a href="copykit-paper.html"><i class="fa fa-check"></i><b>6</b> CopyKit Paper</a>
<ul>
<li class="chapter" data-level="6.1" data-path="copykit-paper.html"><a href="copykit-paper.html#manuscript-code"><i class="fa fa-check"></i><b>6.1</b> Manuscript Code</a></li>
<li class="chapter" data-level="6.2" data-path="copykit-paper.html"><a href="copykit-paper.html#copykit-installation"><i class="fa fa-check"></i><b>6.2</b> CopyKit installation</a></li>
<li class="chapter" data-level="6.3" data-path="copykit-paper.html"><a href="copykit-paper.html#documentation"><i class="fa fa-check"></i><b>6.3</b> Documentation</a></li>
<li class="chapter" data-level="6.4" data-path="copykit-paper.html"><a href="copykit-paper.html#datasets"><i class="fa fa-check"></i><b>6.4</b> Datasets</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bm1" class="section level1" number="3">
<h1><span class="header-section-number">3</span> BM1</h1>
<div id="reading-datasets" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Reading datasets</h2>
<div class="sourceCode" id="cb122"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb122-1"><a href="bm1.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Running data with CopyKit for the primary breast sample</span></span>
<span id="cb122-2"><a href="bm1.html#cb122-2" aria-hidden="true" tabindex="-1"></a>bm1_breast <span class="ot">&lt;-</span></span>
<span id="cb122-3"><a href="bm1.html#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">runVarbin</span>(</span>
<span id="cb122-4"><a href="bm1.html#cb122-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;/mnt/lab/users/dminussi/projects/CopyKit_Manuscript_Code/datasets/BM1/breast/marked_bams/&quot;</span>,</span>
<span id="cb122-5"><a href="bm1.html#cb122-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove_Y =</span> <span class="cn">TRUE</span></span>
<span id="cb122-6"><a href="bm1.html#cb122-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Counting reads for genome hg38 and resolution: 220kb</code></pre>
<pre><code>## 326 bam files had less than 10 mean bincounts and were removed.</code></pre>
<pre><code>## Performing GC correction.</code></pre>
<pre><code>## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442
## Smoothing bin counts.
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442
## Running segmentation algorithm: CBS for genome hg38
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442
## Merging levels.
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442
## Done.</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb127-1"><a href="bm1.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding diploid and low-quality cells and excluding it from the copykit object</span></span>
<span id="cb127-2"><a href="bm1.html#cb127-2" aria-hidden="true" tabindex="-1"></a>bm1_breast <span class="ot">&lt;-</span> <span class="fu">findOutliers</span>(bm1_breast, <span class="at">resolution =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<pre><code>## Calculating correlation matrix.
## Marked 288 cells as outliers.
## Adding information to metadata. Access with colData(scCNA).
## Done.</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb129-1"><a href="bm1.html#cb129-1" aria-hidden="true" tabindex="-1"></a>bm1_breast <span class="ot">&lt;-</span> <span class="fu">findAneuploidCells</span>(bm1_breast)</span></code></pre></div>
<pre><code>## number of iterations= 25</code></pre>
<pre><code>## Copykit detected 83 that are possibly diploid cells using a resolution of: 0.052
## Added information to colData(CopyKit).</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb132-1"><a href="bm1.html#cb132-1" aria-hidden="true" tabindex="-1"></a>bm1_breast <span class="ot">&lt;-</span> bm1_breast[, <span class="fu">colData</span>(bm1_breast)<span class="sc">$</span>outlier <span class="sc">==</span> <span class="cn">FALSE</span>]</span>
<span id="cb132-2"><a href="bm1.html#cb132-2" aria-hidden="true" tabindex="-1"></a>bm1_breast <span class="ot">&lt;-</span> bm1_breast[, <span class="fu">colData</span>(bm1_breast)<span class="sc">$</span>is_aneuploid <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb132-3"><a href="bm1.html#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="bm1.html#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the tissue information to colData</span></span>
<span id="cb132-5"><a href="bm1.html#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(bm1_breast)<span class="sc">$</span>timepoint <span class="ot">&lt;-</span> <span class="st">&#39;breast&#39;</span></span>
<span id="cb132-6"><a href="bm1.html#cb132-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-7"><a href="bm1.html#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb132-8"><a href="bm1.html#cb132-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-9"><a href="bm1.html#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Running data with CopyKit for the liver metastasis sample</span></span>
<span id="cb132-10"><a href="bm1.html#cb132-10" aria-hidden="true" tabindex="-1"></a>bm1_liver <span class="ot">&lt;-</span></span>
<span id="cb132-11"><a href="bm1.html#cb132-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">runVarbin</span>(</span>
<span id="cb132-12"><a href="bm1.html#cb132-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;/mnt/lab/users/dminussi/projects/CopyKit_Manuscript_Code/datasets/BM1/liver/marked_bams/&quot;</span>,</span>
<span id="cb132-13"><a href="bm1.html#cb132-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove_Y =</span> <span class="cn">TRUE</span></span>
<span id="cb132-14"><a href="bm1.html#cb132-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Counting reads for genome hg38 and resolution: 220kb
## 40 bam files had less than 10 mean bincounts and were removed.
## Performing GC correction.
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728
## Smoothing bin counts.
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728
## Running segmentation algorithm: CBS for genome hg38
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724</code></pre>
<pre><code>## Warning in selectChildren(jobs, timeout): error &#39;No child processes&#39; in select</code></pre>
<pre><code>## 725726727728
## Merging levels.
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728
## Done.</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb136-1"><a href="bm1.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding diploid and low-quality cells and excluding it from the copykit object</span></span>
<span id="cb136-2"><a href="bm1.html#cb136-2" aria-hidden="true" tabindex="-1"></a>bm1_liver <span class="ot">&lt;-</span> <span class="fu">findOutliers</span>(bm1_liver)</span></code></pre></div>
<pre><code>## Calculating correlation matrix.
## Marked 295 cells as outliers.
## Adding information to metadata. Access with colData(scCNA).
## Done.</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb138-1"><a href="bm1.html#cb138-1" aria-hidden="true" tabindex="-1"></a>bm1_liver <span class="ot">&lt;-</span> <span class="fu">findAneuploidCells</span>(bm1_liver)</span></code></pre></div>
<pre><code>## number of iterations= 15</code></pre>
<pre><code>## Copykit detected 284 that are possibly diploid cells using a resolution of: 0.051
## Added information to colData(CopyKit).</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb141-1"><a href="bm1.html#cb141-1" aria-hidden="true" tabindex="-1"></a>bm1_liver <span class="ot">&lt;-</span> bm1_liver[, <span class="fu">colData</span>(bm1_liver)<span class="sc">$</span>outlier <span class="sc">==</span> <span class="cn">FALSE</span>]</span>
<span id="cb141-2"><a href="bm1.html#cb141-2" aria-hidden="true" tabindex="-1"></a>bm1_liver <span class="ot">&lt;-</span> bm1_liver[, <span class="fu">colData</span>(bm1_liver)<span class="sc">$</span>is_aneuploid <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb141-3"><a href="bm1.html#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="bm1.html#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the tissue information to colData</span></span>
<span id="cb141-5"><a href="bm1.html#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(bm1_liver)<span class="sc">$</span>timepoint <span class="ot">&lt;-</span> <span class="st">&#39;liver&#39;</span></span>
<span id="cb141-6"><a href="bm1.html#cb141-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-7"><a href="bm1.html#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Running data with CopyKit for the pleural effusion metastasis sample</span></span>
<span id="cb141-8"><a href="bm1.html#cb141-8" aria-hidden="true" tabindex="-1"></a>bm1_pleural <span class="ot">&lt;-</span></span>
<span id="cb141-9"><a href="bm1.html#cb141-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">runVarbin</span>(</span>
<span id="cb141-10"><a href="bm1.html#cb141-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;/mnt/lab/users/dminussi/projects/CopyKit_Manuscript_Code/datasets/BM1/pleural/marked_bams/&quot;</span>,</span>
<span id="cb141-11"><a href="bm1.html#cb141-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove_Y =</span> <span class="cn">TRUE</span></span>
<span id="cb141-12"><a href="bm1.html#cb141-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Counting reads for genome hg38 and resolution: 220kb
## 33 bam files had less than 10 mean bincounts and were removed.
## Performing GC correction.
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351
## Smoothing bin counts.
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351
## Running segmentation algorithm: CBS for genome hg38
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351
## Merging levels.
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351
## Done.</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb143-1"><a href="bm1.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding diploid and low-quality cells and excluding it from the copykit object</span></span>
<span id="cb143-2"><a href="bm1.html#cb143-2" aria-hidden="true" tabindex="-1"></a>bm1_pleural <span class="ot">&lt;-</span> <span class="fu">findOutliers</span>(bm1_pleural)</span></code></pre></div>
<pre><code>## Calculating correlation matrix.
## Marked 106 cells as outliers.
## Adding information to metadata. Access with colData(scCNA).
## Done.</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb145-1"><a href="bm1.html#cb145-1" aria-hidden="true" tabindex="-1"></a>bm1_pleural <span class="ot">&lt;-</span> <span class="fu">findAneuploidCells</span>(bm1_pleural)</span></code></pre></div>
<pre><code>## number of iterations= 14</code></pre>
<pre><code>## Copykit detected 228 that are possibly diploid cells using a resolution of: 0.048
## Added information to colData(CopyKit).</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb148-1"><a href="bm1.html#cb148-1" aria-hidden="true" tabindex="-1"></a>bm1_pleural <span class="ot">&lt;-</span> bm1_pleural[, <span class="fu">colData</span>(bm1_pleural)<span class="sc">$</span>outlier <span class="sc">==</span> <span class="cn">FALSE</span>]</span>
<span id="cb148-2"><a href="bm1.html#cb148-2" aria-hidden="true" tabindex="-1"></a>bm1_pleural <span class="ot">&lt;-</span></span>
<span id="cb148-3"><a href="bm1.html#cb148-3" aria-hidden="true" tabindex="-1"></a>  bm1_pleural[, <span class="fu">colData</span>(bm1_pleural)<span class="sc">$</span>is_aneuploid <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb148-4"><a href="bm1.html#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="bm1.html#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the tissue information to colData</span></span>
<span id="cb148-6"><a href="bm1.html#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(bm1_pleural)<span class="sc">$</span>timepoint <span class="ot">&lt;-</span> <span class="st">&#39;pleural&#39;</span></span></code></pre></div>
<p>Merging the three datasets</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb149-1"><a href="bm1.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging the three copykit objects</span></span>
<span id="cb149-2"><a href="bm1.html#cb149-2" aria-hidden="true" tabindex="-1"></a>bm1_merged <span class="ot">&lt;-</span> <span class="fu">cbind</span>(bm1_breast,</span>
<span id="cb149-3"><a href="bm1.html#cb149-3" aria-hidden="true" tabindex="-1"></a>                    bm1_liver,</span>
<span id="cb149-4"><a href="bm1.html#cb149-4" aria-hidden="true" tabindex="-1"></a>                    bm1_pleural)</span></code></pre></div>
<p>From here on the analysis follow the same steps as a standard CopyKit workflow analysis.</p>
</div>
<div id="running-umap-and-clustering" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Running UMAP and Clustering</h2>
<div class="sourceCode" id="cb150"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb150-1"><a href="bm1.html#cb150-1" aria-hidden="true" tabindex="-1"></a>bm1_merged <span class="ot">&lt;-</span> <span class="fu">runUmap</span>(bm1_merged)</span></code></pre></div>
<pre><code>## Using assay: logr</code></pre>
<pre><code>## Embedding data with UMAP. Using seed 17</code></pre>
<pre><code>## Access reduced dimensions slot with: reducedDim(scCNA, &#39;umap&#39;).</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb155-1"><a href="bm1.html#cb155-1" aria-hidden="true" tabindex="-1"></a>bm1_merged <span class="ot">&lt;-</span> <span class="fu">findSuggestedK</span>(bm1_merged)</span></code></pre></div>
<pre><code>## Calculating jaccard similarity for k range: 10 11 12 13 14 15 16 17 18 19 20 21</code></pre>
<pre><code>## </code></pre>
<pre><code>## iteration: 123456789101112
## Suggested k = 12 with median jaccard similarity of: 0.99</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb159-1"><a href="bm1.html#cb159-1" aria-hidden="true" tabindex="-1"></a>bm1_merged_suggestedk <span class="ot">&lt;-</span> <span class="fu">plotSuggestedK</span>(bm1_merged)</span>
<span id="cb159-2"><a href="bm1.html#cb159-2" aria-hidden="true" tabindex="-1"></a>bm1_merged_suggestedk</span></code></pre></div>
<p><img src="_main_files/figure-html/bm1_umap_cl-1.png" width="672" /></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb160-1"><a href="bm1.html#cb160-1" aria-hidden="true" tabindex="-1"></a>bm1_merged <span class="ot">&lt;-</span> <span class="fu">findClusters</span>(bm1_merged)</span></code></pre></div>
<pre><code>## Using suggested k_subclones = 12
## Finding clusters, using method: hdbscan
## Found 4 subclones.
## Done.</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb162-1"><a href="bm1.html#cb162-1" aria-hidden="true" tabindex="-1"></a>bm1_merged <span class="ot">&lt;-</span> <span class="fu">calcConsensus</span>(bm1_merged)</span></code></pre></div>
<pre><code>## iteration: 1234</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb164-1"><a href="bm1.html#cb164-1" aria-hidden="true" tabindex="-1"></a>bm1_merged <span class="ot">&lt;-</span> <span class="fu">runConsensusPhylo</span>(bm1_merged)</span>
<span id="cb164-2"><a href="bm1.html#cb164-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-3"><a href="bm1.html#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(bm1_merged, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&#39;subclones&#39;</span>, <span class="st">&#39;timepoint&#39;</span>))</span></code></pre></div>
<pre><code>## Plotting Heatmap.
## The automatically generated colors map from the minus and plus 99^th of the absolute values in
## the matrix. There are outliers in the matrix whose patterns might be hidden by this color
## mapping. You can manually set the color to `col` argument.
## 
## Use `suppressMessages()` to turn off this message.</code></pre>
<p><img src="_main_files/figure-html/bm1_umap_cl-2.png" width="672" /></p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb166-1"><a href="bm1.html#cb166-1" aria-hidden="true" tabindex="-1"></a>bm1_merged_umap_p <span class="ot">&lt;-</span> <span class="fu">plotUmap</span>(bm1_merged, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.
## Coloring by: subclones.</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb168-1"><a href="bm1.html#cb168-1" aria-hidden="true" tabindex="-1"></a>bm1_merged_umap_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bm1_umap_cl-3.png" width="672" /></p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb169-1"><a href="bm1.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster c3 from the pleural sample is a cluster of tumor-normal doublets</span></span>
<span id="cb169-2"><a href="bm1.html#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We can subset out of the CopyKit object in a similar way to the filtering</span></span>
<span id="cb169-3"><a href="bm1.html#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="co"># functions with the information from colData</span></span>
<span id="cb169-4"><a href="bm1.html#cb169-4" aria-hidden="true" tabindex="-1"></a>bm1_merged <span class="ot">&lt;-</span> bm1_merged[, <span class="fu">colData</span>(bm1_merged)<span class="sc">$</span>subclones <span class="sc">!=</span> <span class="st">&#39;c3&#39;</span>]</span>
<span id="cb169-5"><a href="bm1.html#cb169-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-6"><a href="bm1.html#cb169-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-clustering the sample after doublet removal</span></span>
<span id="cb169-7"><a href="bm1.html#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This sample has a smaller sample size, therefore we are reducing the</span></span>
<span id="cb169-8"><a href="bm1.html#cb169-8" aria-hidden="true" tabindex="-1"></a><span class="co"># n_neighbors parameter from the UMAP and increasing min_dist</span></span>
<span id="cb169-9"><a href="bm1.html#cb169-9" aria-hidden="true" tabindex="-1"></a>bm1_merged <span class="ot">&lt;-</span> <span class="fu">runUmap</span>(bm1_merged, <span class="at">n_neighbors =</span> <span class="dv">10</span>, <span class="at">min_dist =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<pre><code>## Using assay: logr
## Embedding data with UMAP. Using seed 17
## Access reduced dimensions slot with: reducedDim(scCNA, &#39;umap&#39;).
## Done.</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb171-1"><a href="bm1.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid Search of Jaccard Similarity (cluster stability)</span></span>
<span id="cb171-2"><a href="bm1.html#cb171-2" aria-hidden="true" tabindex="-1"></a>bm1_merged <span class="ot">&lt;-</span> <span class="fu">findSuggestedK</span>(bm1_merged)</span></code></pre></div>
<pre><code>## Calculating jaccard similarity for k range: 10 11 12 13 14 15 16 17 18 19 20</code></pre>
<pre><code>## 
## iteration: 1234567891011
## Suggested k = 15 with median jaccard similarity of: 0.988</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb174-1"><a href="bm1.html#cb174-1" aria-hidden="true" tabindex="-1"></a>bm1_merged <span class="ot">&lt;-</span> <span class="fu">findClusters</span>(bm1_merged)</span></code></pre></div>
<pre><code>## Using suggested k_subclones = 15
## Finding clusters, using method: hdbscan
## Found 4 subclones.
## Done.</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb176-1"><a href="bm1.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the UMAP colored by the tissue of origin from the colData information</span></span>
<span id="cb176-2"><a href="bm1.html#cb176-2" aria-hidden="true" tabindex="-1"></a>bm1_merged_tp_umap_p <span class="ot">&lt;-</span> <span class="fu">plotUmap</span>(bm1_merged, <span class="at">label =</span> <span class="st">&#39;timepoint&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.
## Coloring by: timepoint.</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb178-1"><a href="bm1.html#cb178-1" aria-hidden="true" tabindex="-1"></a>bm1_merged_tp_umap_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bm1_umap_cl-4.png" width="672" /></p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb179-1"><a href="bm1.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the UMAP colored by the subclones from the colData information</span></span>
<span id="cb179-2"><a href="bm1.html#cb179-2" aria-hidden="true" tabindex="-1"></a>bm1_merged_umap_p <span class="ot">&lt;-</span> <span class="fu">plotUmap</span>(bm1_merged, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.
## Coloring by: subclones.</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb181-1"><a href="bm1.html#cb181-1" aria-hidden="true" tabindex="-1"></a>bm1_merged_umap_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bm1_umap_cl-5.png" width="672" /></p>
</div>
<div id="consensus-tree" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Consensus tree</h2>
<p>To root the tree, we will use an inferred Most Recent Common Ancestral from the primary tumor and provide that as an argument to the runConsensusPhylo function.
This consensus tree will be used by plotHeatmap to order the subclones on the plot</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb182-1"><a href="bm1.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The primary sample per se has very few cells so we will add a subclone </span></span>
<span id="cb182-2"><a href="bm1.html#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="co"># information to the colData to use the later inferMrca function in CopyKit</span></span>
<span id="cb182-3"><a href="bm1.html#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(bm1_breast)<span class="sc">$</span>subclones <span class="ot">&lt;-</span> <span class="st">&#39;c1&#39;</span></span>
<span id="cb182-4"><a href="bm1.html#cb182-4" aria-hidden="true" tabindex="-1"></a>bm1_breast <span class="ot">&lt;-</span> <span class="fu">calcConsensus</span>(bm1_breast)</span></code></pre></div>
<pre><code>## iteration: 1</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb184-1"><a href="bm1.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inferring the MRCA on the primary breast sample</span></span>
<span id="cb184-2"><a href="bm1.html#cb184-2" aria-hidden="true" tabindex="-1"></a>bm1_breast <span class="ot">&lt;-</span> <span class="fu">inferMrca</span>(bm1_breast)</span>
<span id="cb184-3"><a href="bm1.html#cb184-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-4"><a href="bm1.html#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculating the consensus of the Merged dataset and using the inferred </span></span>
<span id="cb184-5"><a href="bm1.html#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="co"># primary MRCA as the root of the tree</span></span>
<span id="cb184-6"><a href="bm1.html#cb184-6" aria-hidden="true" tabindex="-1"></a>bm1_merged <span class="ot">&lt;-</span> <span class="fu">calcConsensus</span>(bm1_merged)</span></code></pre></div>
<pre><code>## iteration: 1234</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb186-1"><a href="bm1.html#cb186-1" aria-hidden="true" tabindex="-1"></a>bm1_merged <span class="ot">&lt;-</span> <span class="fu">runConsensusPhylo</span>(bm1_merged,</span>
<span id="cb186-2"><a href="bm1.html#cb186-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">root =</span> <span class="st">&#39;user&#39;</span>,</span>
<span id="cb186-3"><a href="bm1.html#cb186-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">root_user =</span> <span class="fu">metadata</span>(bm1_breast)<span class="sc">$</span>inferred_mrca)</span>
<span id="cb186-4"><a href="bm1.html#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotating branches</span></span>
<span id="cb186-5"><a href="bm1.html#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="fu">consensusPhylo</span>(bm1_merged) <span class="ot">&lt;-</span></span>
<span id="cb186-6"><a href="bm1.html#cb186-6" aria-hidden="true" tabindex="-1"></a>  ape<span class="sc">::</span><span class="fu">rotate</span>(<span class="fu">consensusPhylo</span>(bm1_merged), <span class="dv">6</span>)</span>
<span id="cb186-7"><a href="bm1.html#cb186-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-8"><a href="bm1.html#cb186-8" aria-hidden="true" tabindex="-1"></a>bm1_merged_consensus_phylo <span class="ot">&lt;-</span></span>
<span id="cb186-9"><a href="bm1.html#cb186-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plotPhylo</span>(bm1_merged, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>, <span class="at">consensus =</span> <span class="cn">TRUE</span>)</span>
<span id="cb186-10"><a href="bm1.html#cb186-10" aria-hidden="true" tabindex="-1"></a>bm1_merged_consensus_phylo</span></code></pre></div>
<p><img src="_main_files/figure-html/bm1_tree-1.png" width="672" /></p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb187-1"><a href="bm1.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating cophenetic distances between subclones</span></span>
<span id="cb187-2"><a href="bm1.html#cb187-2" aria-hidden="true" tabindex="-1"></a>ape<span class="sc">::</span><span class="fu">cophenetic.phylo</span>(<span class="fu">consensusPhylo</span>(bm1_merged))</span></code></pre></div>
<pre><code>##           c1       c2        c3       c4
## c1    0.0000  507.340  998.2312 1430.255
## c2  507.3400    0.000 1284.0087 1716.032
## c3  998.2312 1284.009    0.0000 1634.176
## c4 1430.2550 1716.032 1634.1762    0.000</code></pre>
<div class="sourceCode" id="cb189"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb189-1"><a href="bm1.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the copy number heatmap with annotation data from the subclones and</span></span>
<span id="cb189-2"><a href="bm1.html#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the tissue of origin</span></span>
<span id="cb189-3"><a href="bm1.html#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(bm1_merged, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&#39;subclones&#39;</span>, <span class="st">&#39;timepoint&#39;</span>))</span></code></pre></div>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="_main_files/figure-html/bm1_heatmap-1.png" width="768" /></p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb191-1"><a href="bm1.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting a consensus heatmap with the plotHeatmap function. </span></span>
<span id="cb191-2"><a href="bm1.html#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The annotation represents the subclones and relevant cancer genes are marked.</span></span>
<span id="cb191-3"><a href="bm1.html#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(</span>
<span id="cb191-4"><a href="bm1.html#cb191-4" aria-hidden="true" tabindex="-1"></a>  bm1_merged,</span>
<span id="cb191-5"><a href="bm1.html#cb191-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>,</span>
<span id="cb191-6"><a href="bm1.html#cb191-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">consensus =</span> <span class="cn">TRUE</span>,</span>
<span id="cb191-7"><a href="bm1.html#cb191-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">genes =</span> <span class="fu">c</span>(</span>
<span id="cb191-8"><a href="bm1.html#cb191-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;MYC&quot;</span>,</span>
<span id="cb191-9"><a href="bm1.html#cb191-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;MYB&quot;</span>,</span>
<span id="cb191-10"><a href="bm1.html#cb191-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;BRCA1&quot;</span>,</span>
<span id="cb191-11"><a href="bm1.html#cb191-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ERBB2&quot;</span>,</span>
<span id="cb191-12"><a href="bm1.html#cb191-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CDH1&quot;</span>,</span>
<span id="cb191-13"><a href="bm1.html#cb191-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;FGFR1&quot;</span>,</span>
<span id="cb191-14"><a href="bm1.html#cb191-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;AKT2&quot;</span>,</span>
<span id="cb191-15"><a href="bm1.html#cb191-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CDK4&quot;</span>,</span>
<span id="cb191-16"><a href="bm1.html#cb191-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CCNE1&quot;</span>,</span>
<span id="cb191-17"><a href="bm1.html#cb191-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CCND1&quot;</span>,</span>
<span id="cb191-18"><a href="bm1.html#cb191-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;MTOR&quot;</span>,</span>
<span id="cb191-19"><a href="bm1.html#cb191-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;FGF10&quot;</span>,</span>
<span id="cb191-20"><a href="bm1.html#cb191-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;BRAF&quot;</span>,</span>
<span id="cb191-21"><a href="bm1.html#cb191-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;AURKA&quot;</span></span>
<span id="cb191-22"><a href="bm1.html#cb191-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb191-23"><a href="bm1.html#cb191-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Plotting Heatmap.</code></pre>
<pre><code>## The automatically generated colors map from the minus and plus 99^th of the absolute values in
## the matrix. There are outliers in the matrix whose patterns might be hidden by this color
## mapping. You can manually set the color to `col` argument.
## 
## Use `suppressMessages()` to turn off this message.</code></pre>
<p><img src="_main_files/figure-html/bm1_consensus_heatmap_genes-1.png" width="864" /></p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb194-1"><a href="bm1.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the plotGeneCopy function to plot the segment ratios mean values for </span></span>
<span id="cb194-2"><a href="bm1.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the selected genes and coloring it by the tissue of origin from the metadata</span></span>
<span id="cb194-3"><a href="bm1.html#cb194-3" aria-hidden="true" tabindex="-1"></a>bm1_merged_gc <span class="ot">&lt;-</span></span>
<span id="cb194-4"><a href="bm1.html#cb194-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plotGeneCopy</span>(</span>
<span id="cb194-5"><a href="bm1.html#cb194-5" aria-hidden="true" tabindex="-1"></a>    bm1_merged,</span>
<span id="cb194-6"><a href="bm1.html#cb194-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">genes =</span> <span class="fu">c</span>(</span>
<span id="cb194-7"><a href="bm1.html#cb194-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;MYC&quot;</span>,</span>
<span id="cb194-8"><a href="bm1.html#cb194-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;MYB&quot;</span>,</span>
<span id="cb194-9"><a href="bm1.html#cb194-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;BRCA1&quot;</span>,</span>
<span id="cb194-10"><a href="bm1.html#cb194-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;ERBB2&quot;</span>,</span>
<span id="cb194-11"><a href="bm1.html#cb194-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;CDH1&quot;</span>,</span>
<span id="cb194-12"><a href="bm1.html#cb194-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;FGFR1&quot;</span>,</span>
<span id="cb194-13"><a href="bm1.html#cb194-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;AKT2&quot;</span>,</span>
<span id="cb194-14"><a href="bm1.html#cb194-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;CDK4&quot;</span>,</span>
<span id="cb194-15"><a href="bm1.html#cb194-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;CCNE1&quot;</span>,</span>
<span id="cb194-16"><a href="bm1.html#cb194-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;CCND1&quot;</span>,</span>
<span id="cb194-17"><a href="bm1.html#cb194-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;MTOR&quot;</span>,</span>
<span id="cb194-18"><a href="bm1.html#cb194-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;FGF10&quot;</span>,</span>
<span id="cb194-19"><a href="bm1.html#cb194-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;BRAF&quot;</span>,</span>
<span id="cb194-20"><a href="bm1.html#cb194-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;AURKA&quot;</span></span>
<span id="cb194-21"><a href="bm1.html#cb194-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb194-22"><a href="bm1.html#cb194-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">&#39;timepoint&#39;</span>,</span>
<span id="cb194-23"><a href="bm1.html#cb194-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">dodge.width =</span> .<span class="dv">8</span></span>
<span id="cb194-24"><a href="bm1.html#cb194-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb194-25"><a href="bm1.html#cb194-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>()</span></code></pre></div>
<pre><code>## Coloring by: timepoint</code></pre>
<pre><code>## Scale for &#39;fill&#39; is already present. Adding another scale for &#39;fill&#39;, which will replace the existing
## scale.</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb197-1"><a href="bm1.html#cb197-1" aria-hidden="true" tabindex="-1"></a>bm1_merged_gc</span></code></pre></div>
<p><img src="_main_files/figure-html/bm1_consensus_heatmap_genes-2.png" width="864" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bl1-and-bl2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cm1-and-cm2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/navinlabcode/copykit/blob/master/03-bm1.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
