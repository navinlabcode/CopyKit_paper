<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 BL1 and BL2 | _main.knit</title>
  <meta name="description" content="<p>This is the code from the figures presented in the CopyKit manuscript -
Resolving clonal substructure from single cell genomic data using CopyKit.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="2 BL1 and BL2 | _main.knit" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>This is the code from the figures presented in the CopyKit manuscript -
Resolving clonal substructure from single cell genomic data using CopyKit.</p>" />
  <meta name="github-repo" content="navinlabcode/copykit" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 BL1 and BL2 | _main.knit" />
  
  <meta name="twitter:description" content="<p>This is the code from the figures presented in the CopyKit manuscript -
Resolving clonal substructure from single cell genomic data using CopyKit.</p>" />
  

<meta name="author" content="Darlan Conterno Minussi" />


<meta name="date" content="2022-02-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="bm1.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CopyKit Manuscript Code</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html"><i class="fa fa-check"></i><b>2</b> BL1 and BL2</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#bl1"><i class="fa fa-check"></i><b>2.1</b> BL1</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#filtering"><i class="fa fa-check"></i><b>2.1.1</b> Filtering</a></li>
<li class="chapter" data-level="2.1.2" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#umap-and-clustering"><i class="fa fa-check"></i><b>2.1.2</b> UMAP and clustering</a></li>
<li class="chapter" data-level="2.1.3" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#subclones-heatmap"><i class="fa fa-check"></i><b>2.1.3</b> Subclones Heatmap</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#bl2"><i class="fa fa-check"></i><b>2.2</b> BL2</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#filtering-1"><i class="fa fa-check"></i><b>2.2.1</b> Filtering</a></li>
<li class="chapter" data-level="2.2.2" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#umap-and-clustering-1"><i class="fa fa-check"></i><b>2.2.2</b> UMAP and clustering</a></li>
<li class="chapter" data-level="2.2.3" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#subclones-heatmap-1"><i class="fa fa-check"></i><b>2.2.3</b> Subclones Heatmap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bm1.html"><a href="bm1.html"><i class="fa fa-check"></i><b>3</b> BM1</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bm1.html"><a href="bm1.html#reading-datasets"><i class="fa fa-check"></i><b>3.1</b> Reading datasets</a></li>
<li class="chapter" data-level="3.2" data-path="bm1.html"><a href="bm1.html#running-umap-and-clustering"><i class="fa fa-check"></i><b>3.2</b> Running UMAP and Clustering</a></li>
<li class="chapter" data-level="3.3" data-path="bm1.html"><a href="bm1.html#consensus-tree"><i class="fa fa-check"></i><b>3.3</b> Consensus tree</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html"><i class="fa fa-check"></i><b>4</b> CM1 and CM2</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm1"><i class="fa fa-check"></i><b>4.1</b> CM1</a></li>
<li class="chapter" data-level="4.2" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm1-colon"><i class="fa fa-check"></i><b>4.2</b> CM1 colon</a></li>
<li class="chapter" data-level="4.3" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm1-liver"><i class="fa fa-check"></i><b>4.3</b> CM1 liver</a></li>
<li class="chapter" data-level="4.4" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm1-merging"><i class="fa fa-check"></i><b>4.4</b> CM1 merging</a></li>
<li class="chapter" data-level="4.5" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm2"><i class="fa fa-check"></i><b>4.5</b> CM2</a></li>
<li class="chapter" data-level="4.6" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm2-colon"><i class="fa fa-check"></i><b>4.6</b> CM2 colon</a></li>
<li class="chapter" data-level="4.7" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm2-liver"><i class="fa fa-check"></i><b>4.7</b> CM2 liver</a></li>
<li class="chapter" data-level="4.8" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm2-merging"><i class="fa fa-check"></i><b>4.8</b> CM2 merging</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="session-info.html"><a href="session-info.html"><i class="fa fa-check"></i><b>5</b> Session Info</a></li>
<li class="chapter" data-level="6" data-path="copykit-paper.html"><a href="copykit-paper.html"><i class="fa fa-check"></i><b>6</b> CopyKit Paper</a>
<ul>
<li class="chapter" data-level="6.1" data-path="copykit-paper.html"><a href="copykit-paper.html#manuscript-code"><i class="fa fa-check"></i><b>6.1</b> Manuscript Code</a></li>
<li class="chapter" data-level="6.2" data-path="copykit-paper.html"><a href="copykit-paper.html#copykit-installation"><i class="fa fa-check"></i><b>6.2</b> CopyKit installation</a></li>
<li class="chapter" data-level="6.3" data-path="copykit-paper.html"><a href="copykit-paper.html#documentation"><i class="fa fa-check"></i><b>6.3</b> Documentation</a></li>
<li class="chapter" data-level="6.4" data-path="copykit-paper.html"><a href="copykit-paper.html#datasets"><i class="fa fa-check"></i><b>6.4</b> Datasets</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bl1-and-bl2" class="section level1" number="2">
<h1><span class="header-section-number">2</span> BL1 and BL2</h1>
<p>Setup</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb3-1"><a href="bl1-and-bl2.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(copykit))</span>
<span id="cb3-2"><a href="bl1-and-bl2.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb3-3"><a href="bl1-and-bl2.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstatix)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;rstatix&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:IRanges&#39;:
## 
##     desc</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb7-1"><a href="bl1-and-bl2.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(tidyverse))</span>
<span id="cb7-2"><a href="bl1-and-bl2.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb7-3"><a href="bl1-and-bl2.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggnewscale)</span>
<span id="cb7-4"><a href="bl1-and-bl2.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;janitor&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:rstatix&#39;:
## 
##     make_clean_names</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     chisq.test, fisher.test</code></pre>
<p>Functions to Calculate Shannon Diversity Indexes</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb11-1"><a href="bl1-and-bl2.html#cb11-1" aria-hidden="true" tabindex="-1"></a>shan <span class="ot">&lt;-</span> <span class="cf">function</span>(data, indices) {</span>
<span id="cb11-2"><a href="bl1-and-bl2.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  data_ind <span class="ot">&lt;-</span> data[indices]</span>
<span id="cb11-3"><a href="bl1-and-bl2.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  prop <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">tabyl</span>(data_ind) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(percent)</span>
<span id="cb11-4"><a href="bl1-and-bl2.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  div <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">sum</span>(prop<span class="sc">*</span><span class="fu">log</span>(prop))</span>
<span id="cb11-5"><a href="bl1-and-bl2.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(div)</span>
<span id="cb11-6"><a href="bl1-and-bl2.html#cb11-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-7"><a href="bl1-and-bl2.html#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="bl1-and-bl2.html#cb11-8" aria-hidden="true" tabindex="-1"></a>shan_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(meta, group) {</span>
<span id="cb11-9"><a href="bl1-and-bl2.html#cb11-9" aria-hidden="true" tabindex="-1"></a>  meta_group <span class="ot">&lt;-</span> meta <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="bl1-and-bl2.html#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(sectors <span class="sc">==</span> <span class="sc">!!</span>group)</span>
<span id="cb11-11"><a href="bl1-and-bl2.html#cb11-11" aria-hidden="true" tabindex="-1"></a>  group_perc <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">tabyl</span>(<span class="fu">as.character</span>(meta_group<span class="sc">$</span>subclones)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(percent)</span>
<span id="cb11-12"><a href="bl1-and-bl2.html#cb11-12" aria-hidden="true" tabindex="-1"></a>  group_div <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">sum</span>(group_perc<span class="sc">*</span><span class="fu">log</span>(group_perc))</span>
<span id="cb11-13"><a href="bl1-and-bl2.html#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="bl1-and-bl2.html#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for sectors composed of a unique subclone</span></span>
<span id="cb11-15"><a href="bl1-and-bl2.html#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (group_div <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb11-16"><a href="bl1-and-bl2.html#cb11-16" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">foci =</span> group,</span>
<span id="cb11-17"><a href="bl1-and-bl2.html#cb11-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">div =</span> <span class="dv">0</span>,</span>
<span id="cb11-18"><a href="bl1-and-bl2.html#cb11-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lci =</span> <span class="dv">0</span>,</span>
<span id="cb11-19"><a href="bl1-and-bl2.html#cb11-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">uci =</span> <span class="dv">0</span>)</span>
<span id="cb11-20"><a href="bl1-and-bl2.html#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb11-21"><a href="bl1-and-bl2.html#cb11-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-22"><a href="bl1-and-bl2.html#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="bl1-and-bl2.html#cb11-23" aria-hidden="true" tabindex="-1"></a>  shan_group_boot <span class="ot">&lt;-</span></span>
<span id="cb11-24"><a href="bl1-and-bl2.html#cb11-24" aria-hidden="true" tabindex="-1"></a>    boot<span class="sc">::</span><span class="fu">boot</span>(</span>
<span id="cb11-25"><a href="bl1-and-bl2.html#cb11-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(meta_group<span class="sc">$</span>subclones),</span>
<span id="cb11-26"><a href="bl1-and-bl2.html#cb11-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">statistic =</span> shan,</span>
<span id="cb11-27"><a href="bl1-and-bl2.html#cb11-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">R =</span> <span class="dv">2000</span></span>
<span id="cb11-28"><a href="bl1-and-bl2.html#cb11-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-29"><a href="bl1-and-bl2.html#cb11-29" aria-hidden="true" tabindex="-1"></a>  shan_group_boot_ci <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(boot<span class="sc">::</span><span class="fu">boot.ci</span>(shan_group_boot))</span>
<span id="cb11-30"><a href="bl1-and-bl2.html#cb11-30" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">foci =</span> group,</span>
<span id="cb11-31"><a href="bl1-and-bl2.html#cb11-31" aria-hidden="true" tabindex="-1"></a>                   <span class="at">div =</span> group_div,</span>
<span id="cb11-32"><a href="bl1-and-bl2.html#cb11-32" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lci =</span> shan_group_boot_ci<span class="sc">$</span>normal[<span class="dv">2</span>],</span>
<span id="cb11-33"><a href="bl1-and-bl2.html#cb11-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">uci =</span> shan_group_boot_ci<span class="sc">$</span>normal[<span class="dv">3</span>])</span>
<span id="cb11-34"><a href="bl1-and-bl2.html#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="bl1-and-bl2.html#cb11-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="bl1" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> BL1</h2>
<div id="filtering" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Filtering</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb12-1"><a href="bl1-and-bl2.html#cb12-1" aria-hidden="true" tabindex="-1"></a>bl1 <span class="ot">&lt;-</span> <span class="fu">runVarbin</span>(<span class="st">&quot;/mnt/lab/users/dminussi/projects/CopyKit_Manuscript_Code/datasets/BL1/marked_bams/&quot;</span>, <span class="at">remove_Y =</span> T)</span></code></pre></div>
<pre><code>## Counting reads for genome hg38 and resolution: 220kb</code></pre>
<pre><code>## 34 bam files had less than 10 mean bincounts and were removed.</code></pre>
<pre><code>## Performing GC correction.</code></pre>
<pre><code>## Smoothing bin counts.</code></pre>
<pre><code>## Running segmentation algorithm: CBS for genome hg38</code></pre>
<pre><code>## Merging levels.</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb20-1"><a href="bl1-and-bl2.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding diploid cells and sub-setting the copykit object</span></span>
<span id="cb20-2"><a href="bl1-and-bl2.html#cb20-2" aria-hidden="true" tabindex="-1"></a>bl1 <span class="ot">&lt;-</span> <span class="fu">findAneuploidCells</span>(bl1)</span></code></pre></div>
<pre><code>## number of iterations= 28</code></pre>
<pre><code>## Copykit detected 607 that are possibly diploid cells using a resolution of: 0.069</code></pre>
<pre><code>## Added information to colData(CopyKit).</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb24-1"><a href="bl1-and-bl2.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(bl1, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&#39;is_aneuploid&#39;</span>),</span>
<span id="cb24-2"><a href="bl1-and-bl2.html#cb24-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">row_split =</span> <span class="st">&#39;is_aneuploid&#39;</span>,</span>
<span id="cb24-3"><a href="bl1-and-bl2.html#cb24-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_threads =</span> <span class="dv">50</span>)</span></code></pre></div>
<pre><code>## Ordering by consensus requires cluster information.</code></pre>
<pre><code>## Switching to hclust.</code></pre>
<pre><code>## No distance matrix detected in the scCNA object.</code></pre>
<pre><code>## Calculating distance matrix with metric: euclidean</code></pre>
<pre><code>## Using 50 cores.</code></pre>
<pre><code>## Access distance matrix with copykit::distMat()</code></pre>
<pre><code>## Done.</code></pre>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-3-1.png" width="768" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb33-1"><a href="bl1-and-bl2.html#cb33-1" aria-hidden="true" tabindex="-1"></a>bl1 <span class="ot">&lt;-</span> bl1[,<span class="fu">colData</span>(bl1)<span class="sc">$</span>is_aneuploid <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb33-2"><a href="bl1-and-bl2.html#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="bl1-and-bl2.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding low-quality cells</span></span>
<span id="cb33-4"><a href="bl1-and-bl2.html#cb33-4" aria-hidden="true" tabindex="-1"></a>bl1 <span class="ot">&lt;-</span> <span class="fu">findOutliers</span>(bl1)</span></code></pre></div>
<pre><code>## Calculating correlation matrix.</code></pre>
<pre><code>## Marked 102 cells as outliers.</code></pre>
<pre><code>## Adding information to metadata. Access with colData(scCNA).</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb38-1"><a href="bl1-and-bl2.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(bl1, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&#39;outlier&#39;</span>),</span>
<span id="cb38-2"><a href="bl1-and-bl2.html#cb38-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">row_split =</span> <span class="st">&#39;outlier&#39;</span>,</span>
<span id="cb38-3"><a href="bl1-and-bl2.html#cb38-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_threads =</span> <span class="dv">50</span>)</span></code></pre></div>
<pre><code>## Ordering by consensus requires cluster information.</code></pre>
<pre><code>## Switching to hclust.</code></pre>
<pre><code>## No distance matrix detected in the scCNA object.</code></pre>
<pre><code>## Calculating distance matrix with metric: euclidean</code></pre>
<pre><code>## Using 50 cores.</code></pre>
<pre><code>## Access distance matrix with copykit::distMat()</code></pre>
<pre><code>## Done.</code></pre>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-3-2.png" width="768" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb47-1"><a href="bl1-and-bl2.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># obtaining metrics and plotting</span></span>
<span id="cb47-2"><a href="bl1-and-bl2.html#cb47-2" aria-hidden="true" tabindex="-1"></a>bl1 <span class="ot">&lt;-</span> <span class="fu">runMetrics</span>(bl1)</span></code></pre></div>
<pre><code>## Calculating overdispersion.</code></pre>
<pre><code>## Warning in selectChildren(jobs, timeout): error &#39;No child processes&#39; in select</code></pre>
<pre><code>## Counting breakpoints.</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb52-1"><a href="bl1-and-bl2.html#cb52-1" aria-hidden="true" tabindex="-1"></a>bl1_p_metrics <span class="ot">&lt;-</span> <span class="fu">plotMetrics</span>(</span>
<span id="cb52-2"><a href="bl1-and-bl2.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  bl1,</span>
<span id="cb52-3"><a href="bl1-and-bl2.html#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="fu">c</span>(</span>
<span id="cb52-4"><a href="bl1-and-bl2.html#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;reads_total&quot;</span>,</span>
<span id="cb52-5"><a href="bl1-and-bl2.html#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;percentage_duplicates&quot;</span>,</span>
<span id="cb52-6"><a href="bl1-and-bl2.html#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;overdispersion&quot;</span>,</span>
<span id="cb52-7"><a href="bl1-and-bl2.html#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;breakpoint_count&quot;</span></span>
<span id="cb52-8"><a href="bl1-and-bl2.html#cb52-8" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">label =</span> <span class="st">&#39;outlier&#39;</span>,</span>
<span id="cb52-9"><a href="bl1-and-bl2.html#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dodge.width =</span> <span class="fl">0.8</span>,</span>
<span id="cb52-10"><a href="bl1-and-bl2.html#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb52-11"><a href="bl1-and-bl2.html#cb52-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;TRUE&quot;</span> <span class="ot">=</span> <span class="st">&quot;#DA614D&quot;</span>,</span>
<span id="cb52-12"><a href="bl1-and-bl2.html#cb52-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;FALSE&quot;</span> <span class="ot">=</span> <span class="st">&quot;#5F917A&quot;</span>))</span></code></pre></div>
<pre><code>## Coloring by: outlier</code></pre>
<pre><code>## Scale for &#39;fill&#39; is already present. Adding another scale for &#39;fill&#39;, which will replace the existing
## scale.</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb55-1"><a href="bl1-and-bl2.html#cb55-1" aria-hidden="true" tabindex="-1"></a>bl1_p_metrics</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-3-3.png" width="768" /></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb56-1"><a href="bl1-and-bl2.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculating averages from the colData information and statistics</span></span>
<span id="cb56-2"><a href="bl1-and-bl2.html#cb56-2" aria-hidden="true" tabindex="-1"></a>bl1_metrics <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(bl1))</span>
<span id="cb56-3"><a href="bl1-and-bl2.html#cb56-3" aria-hidden="true" tabindex="-1"></a>bl1_metrics <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="bl1-and-bl2.html#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">reads_total_mean =</span> <span class="fu">mean</span>(reads_total),</span>
<span id="cb56-5"><a href="bl1-and-bl2.html#cb56-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">reads_total_sd =</span> <span class="fu">sd</span>(reads_total),</span>
<span id="cb56-6"><a href="bl1-and-bl2.html#cb56-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">percent_dup_mean =</span> <span class="fu">mean</span>(percentage_duplicates),</span>
<span id="cb56-7"><a href="bl1-and-bl2.html#cb56-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">percent_dup_sd =</span> <span class="fu">sd</span>(percentage_duplicates)</span>
<span id="cb56-8"><a href="bl1-and-bl2.html#cb56-8" aria-hidden="true" tabindex="-1"></a>            )</span></code></pre></div>
<pre><code>##   reads_total_mean reads_total_sd percent_dup_mean percent_dup_sd
## 1          1035783         246883       0.08147598    0.009734118</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb58-1"><a href="bl1-and-bl2.html#cb58-1" aria-hidden="true" tabindex="-1"></a>bl1_metrics <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="bl1-and-bl2.html#cb58-2" aria-hidden="true" tabindex="-1"></a>  rstatix<span class="sc">::</span><span class="fu">kruskal_test</span>(overdispersion <span class="sc">~</span> outlier)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   .y.                n statistic    df     p method        
## * &lt;chr&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         
## 1 overdispersion   895      3.95     1 0.047 Kruskal-Wallis</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb60-1"><a href="bl1-and-bl2.html#cb60-1" aria-hidden="true" tabindex="-1"></a>bl1_metrics <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="bl1-and-bl2.html#cb60-2" aria-hidden="true" tabindex="-1"></a>  rstatix<span class="sc">::</span><span class="fu">kruskal_test</span>(breakpoint_count <span class="sc">~</span> outlier)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   .y.                  n statistic    df        p method        
## * &lt;chr&gt;            &lt;int&gt;     &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;         
## 1 breakpoint_count   895      63.2     1 1.87e-15 Kruskal-Wallis</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb62-1"><a href="bl1-and-bl2.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># removing low-quality cells</span></span>
<span id="cb62-2"><a href="bl1-and-bl2.html#cb62-2" aria-hidden="true" tabindex="-1"></a>bl1 <span class="ot">&lt;-</span> bl1[,<span class="fu">colData</span>(bl1)<span class="sc">$</span>outlier <span class="sc">==</span> <span class="cn">FALSE</span>]</span></code></pre></div>
</div>
<div id="umap-and-clustering" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> UMAP and clustering</h3>
<div class="sourceCode" id="cb63"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb63-1"><a href="bl1-and-bl2.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Running UMAP and storing into the copykit object</span></span>
<span id="cb63-2"><a href="bl1-and-bl2.html#cb63-2" aria-hidden="true" tabindex="-1"></a>bl1 <span class="ot">&lt;-</span> <span class="fu">runUmap</span>(bl1)</span></code></pre></div>
<pre><code>## Using assay: logr</code></pre>
<pre><code>## Embedding data with UMAP. Using seed 17</code></pre>
<pre><code>## Access reduced dimensions slot with: reducedDim(scCNA, &#39;umap&#39;).</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb68-1"><a href="bl1-and-bl2.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid Search of Jaccard Similarity (cluster stability)</span></span>
<span id="cb68-2"><a href="bl1-and-bl2.html#cb68-2" aria-hidden="true" tabindex="-1"></a>bl1 <span class="ot">&lt;-</span> <span class="fu">findSuggestedK</span>(bl1)</span></code></pre></div>
<pre><code>## Calculating jaccard similarity for k range: 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28</code></pre>
<pre><code>## </code></pre>
<pre><code>## Suggested k = 10 with median jaccard similarity of: 1</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb72-1"><a href="bl1-and-bl2.html#cb72-1" aria-hidden="true" tabindex="-1"></a>bl1_primary_suggestedK_p <span class="ot">&lt;-</span> <span class="fu">plotSuggestedK</span>(bl1)</span>
<span id="cb72-2"><a href="bl1-and-bl2.html#cb72-2" aria-hidden="true" tabindex="-1"></a>bl1_primary_suggestedK_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bl1_umap_cl-1.png" width="672" /></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb73-1"><a href="bl1-and-bl2.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding clusters using the suggested k value as per default settings, </span></span>
<span id="cb73-2"><a href="bl1-and-bl2.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co"># can be changed with the argument k_subclones</span></span>
<span id="cb73-3"><a href="bl1-and-bl2.html#cb73-3" aria-hidden="true" tabindex="-1"></a>bl1 <span class="ot">&lt;-</span> <span class="fu">findClusters</span>(bl1)</span></code></pre></div>
<pre><code>## Using suggested k_subclones = 10</code></pre>
<pre><code>## Finding clusters, using method: hdbscan</code></pre>
<pre><code>## Found 4 subclones.</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb78-1"><a href="bl1-and-bl2.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting UMAP colored by subclones</span></span>
<span id="cb78-2"><a href="bl1-and-bl2.html#cb78-2" aria-hidden="true" tabindex="-1"></a>bl1_umap_p <span class="ot">&lt;-</span> <span class="fu">plotUmap</span>(bl1, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.</code></pre>
<pre><code>## Coloring by: subclones.</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb81-1"><a href="bl1-and-bl2.html#cb81-1" aria-hidden="true" tabindex="-1"></a>bl1_umap_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bl1_umap_cl-2.png" width="672" /></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb82-1"><a href="bl1-and-bl2.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating consensus matrix and consensus phylo, </span></span>
<span id="cb82-2"><a href="bl1-and-bl2.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this will be used by copykit to order the subclones on the heatmap</span></span>
<span id="cb82-3"><a href="bl1-and-bl2.html#cb82-3" aria-hidden="true" tabindex="-1"></a>bl1 <span class="ot">&lt;-</span> <span class="fu">calcConsensus</span>(bl1)</span>
<span id="cb82-4"><a href="bl1-and-bl2.html#cb82-4" aria-hidden="true" tabindex="-1"></a>bl1 <span class="ot">&lt;-</span> <span class="fu">runConsensusPhylo</span>(bl1)</span></code></pre></div>
</div>
<div id="subclones-heatmap" class="section level3" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Subclones Heatmap</h3>
<div class="sourceCode" id="cb83"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb83-1"><a href="bl1-and-bl2.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting copy number heatmap and annotating with subclones</span></span>
<span id="cb83-2"><a href="bl1-and-bl2.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(bl1, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&#39;subclones&#39;</span>))</span></code></pre></div>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="_main_files/figure-html/bl1_subclones-1.png" width="768" /></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb85-1"><a href="bl1-and-bl2.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding macro-spatial information from file names to colData</span></span>
<span id="cb85-2"><a href="bl1-and-bl2.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and renaming to (S)ectors</span></span>
<span id="cb85-3"><a href="bl1-and-bl2.html#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(bl1)<span class="sc">$</span>sectors <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="fu">colData</span>(bl1)<span class="sc">$</span>sample, <span class="st">&quot;(L[0-9]+L[0-9]+|L[0-9]+)&quot;</span>)</span>
<span id="cb85-4"><a href="bl1-and-bl2.html#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(bl1)<span class="sc">$</span>sectors <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="fu">colData</span>(bl1)<span class="sc">$</span>sectors,</span>
<span id="cb85-5"><a href="bl1-and-bl2.html#cb85-5" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">&quot;L&quot;</span>, <span class="st">&quot;S&quot;</span>)</span>
<span id="cb85-6"><a href="bl1-and-bl2.html#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="bl1-and-bl2.html#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the UMAP colored by sectors</span></span>
<span id="cb85-8"><a href="bl1-and-bl2.html#cb85-8" aria-hidden="true" tabindex="-1"></a>bl1_umap_sectors_p <span class="ot">&lt;-</span> <span class="fu">plotUmap</span>(bl1, <span class="at">label =</span> <span class="st">&#39;sectors&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.</code></pre>
<pre><code>## Coloring by: sectors.</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb88-1"><a href="bl1-and-bl2.html#cb88-1" aria-hidden="true" tabindex="-1"></a>bl1_umap_sectors_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bl1_spatial_sections-1.png" width="672" /></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb89-1"><a href="bl1-and-bl2.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating pie charts plots of the proportions of clones on each sector</span></span>
<span id="cb89-2"><a href="bl1-and-bl2.html#cb89-2" aria-hidden="true" tabindex="-1"></a>bl1_focis <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">colData</span>(bl1)<span class="sc">$</span>sectors)</span>
<span id="cb89-3"><a href="bl1-and-bl2.html#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="bl1-and-bl2.html#cb89-4" aria-hidden="true" tabindex="-1"></a>bl1_foci_pies <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb89-5"><a href="bl1-and-bl2.html#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="bl1-and-bl2.html#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(bl1_focis)) {</span>
<span id="cb89-7"><a href="bl1-and-bl2.html#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="bl1-and-bl2.html#cb89-8" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(bl1)) <span class="sc">%&gt;%</span></span>
<span id="cb89-9"><a href="bl1-and-bl2.html#cb89-9" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(sectors <span class="sc">==</span> bl1_focis[i])</span>
<span id="cb89-10"><a href="bl1-and-bl2.html#cb89-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-11"><a href="bl1-and-bl2.html#cb89-11" aria-hidden="true" tabindex="-1"></a>  bl1_foci_pies[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb89-12"><a href="bl1-and-bl2.html#cb89-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> sectors, <span class="at">fill =</span> subclones),</span>
<span id="cb89-13"><a href="bl1-and-bl2.html#cb89-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="sc">+</span></span>
<span id="cb89-14"><a href="bl1-and-bl2.html#cb89-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb89-15"><a href="bl1-and-bl2.html#cb89-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">subclones_pal</span>(),</span>
<span id="cb89-16"><a href="bl1-and-bl2.html#cb89-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">limits =</span> force) <span class="sc">+</span></span>
<span id="cb89-17"><a href="bl1-and-bl2.html#cb89-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb89-18"><a href="bl1-and-bl2.html#cb89-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(bl1_focis[i])</span>
<span id="cb89-19"><a href="bl1-and-bl2.html#cb89-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-20"><a href="bl1-and-bl2.html#cb89-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-21"><a href="bl1-and-bl2.html#cb89-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-22"><a href="bl1-and-bl2.html#cb89-22" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(bl1_foci_pies)</span></code></pre></div>
<p><img src="_main_files/figure-html/bl1_spatial_sections-2.png" width="672" /></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb90-1"><a href="bl1-and-bl2.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting up a theme for the next plot</span></span>
<span id="cb90-2"><a href="bl1-and-bl2.html#cb90-2" aria-hidden="true" tabindex="-1"></a>my_theme <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb90-3"><a href="bl1-and-bl2.html#cb90-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb90-4"><a href="bl1-and-bl2.html#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;gray28&quot;</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb90-5"><a href="bl1-and-bl2.html#cb90-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-6"><a href="bl1-and-bl2.html#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-7"><a href="bl1-and-bl2.html#cb90-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;gray28&quot;</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb90-8"><a href="bl1-and-bl2.html#cb90-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-9"><a href="bl1-and-bl2.html#cb90-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-10"><a href="bl1-and-bl2.html#cb90-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-11"><a href="bl1-and-bl2.html#cb90-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb90-12"><a href="bl1-and-bl2.html#cb90-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&#39;black&#39;</span>)</span>
<span id="cb90-13"><a href="bl1-and-bl2.html#cb90-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb90-14"><a href="bl1-and-bl2.html#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;umap1&quot;</span>),</span>
<span id="cb90-15"><a href="bl1-and-bl2.html#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;umap2&quot;</span>)</span>
<span id="cb90-16"><a href="bl1-and-bl2.html#cb90-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-17"><a href="bl1-and-bl2.html#cb90-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-18"><a href="bl1-and-bl2.html#cb90-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the UMAP colored by sector and using ggrepel to label the subclones</span></span>
<span id="cb90-19"><a href="bl1-and-bl2.html#cb90-19" aria-hidden="true" tabindex="-1"></a>bl1_lfoci_umap <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">reducedDim</span>(bl1, <span class="st">&#39;umap&#39;</span>))</span>
<span id="cb90-20"><a href="bl1-and-bl2.html#cb90-20" aria-hidden="true" tabindex="-1"></a>bl1_lfoci_umap<span class="sc">$</span>sectors <span class="ot">&lt;-</span> <span class="fu">colData</span>(bl1)<span class="sc">$</span>sectors</span>
<span id="cb90-21"><a href="bl1-and-bl2.html#cb90-21" aria-hidden="true" tabindex="-1"></a>bl1_lfoci_umap<span class="sc">$</span>subclones <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">colData</span>(bl1)<span class="sc">$</span>subclones)</span>
<span id="cb90-22"><a href="bl1-and-bl2.html#cb90-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Avoiding overplotting of text</span></span>
<span id="cb90-23"><a href="bl1-and-bl2.html#cb90-23" aria-hidden="true" tabindex="-1"></a>bl1_lfoci_umap<span class="sc">$</span>subclones <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">duplicated</span>(bl1_lfoci_umap<span class="sc">$</span>subclones),</span>
<span id="cb90-24"><a href="bl1-and-bl2.html#cb90-24" aria-hidden="true" tabindex="-1"></a>                                   bl1_lfoci_umap<span class="sc">$</span>subclones, <span class="st">&quot;&quot;</span>)</span>
<span id="cb90-25"><a href="bl1-and-bl2.html#cb90-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-26"><a href="bl1-and-bl2.html#cb90-26" aria-hidden="true" tabindex="-1"></a>bl1_lfoci_umap_p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bl1_lfoci_umap, <span class="fu">aes</span>(V1, V2, <span class="at">label =</span> subclones)) <span class="sc">+</span></span>
<span id="cb90-27"><a href="bl1-and-bl2.html#cb90-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> sectors), <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb90-28"><a href="bl1-and-bl2.html#cb90-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">stroke =</span> <span class="fl">0.1</span>,</span>
<span id="cb90-29"><a href="bl1-and-bl2.html#cb90-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb90-30"><a href="bl1-and-bl2.html#cb90-30" aria-hidden="true" tabindex="-1"></a>  ggnewscale<span class="sc">::</span><span class="fu">new_scale_fill</span>() <span class="sc">+</span></span>
<span id="cb90-31"><a href="bl1-and-bl2.html#cb90-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">color =</span> subclones),</span>
<span id="cb90-32"><a href="bl1-and-bl2.html#cb90-32" aria-hidden="true" tabindex="-1"></a>                   <span class="at">min.segment.length =</span> <span class="dv">0</span>,</span>
<span id="cb90-33"><a href="bl1-and-bl2.html#cb90-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">box.padding =</span> <span class="fl">0.01</span>,</span>
<span id="cb90-34"><a href="bl1-and-bl2.html#cb90-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb90-35"><a href="bl1-and-bl2.html#cb90-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">max.overlaps =</span> <span class="cn">Inf</span>,</span>
<span id="cb90-36"><a href="bl1-and-bl2.html#cb90-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na.rm =</span> T) <span class="sc">+</span></span>
<span id="cb90-37"><a href="bl1-and-bl2.html#cb90-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">subclones_pal</span>(),</span>
<span id="cb90-38"><a href="bl1-and-bl2.html#cb90-38" aria-hidden="true" tabindex="-1"></a>                    <span class="at">limits =</span> force) <span class="sc">+</span></span>
<span id="cb90-39"><a href="bl1-and-bl2.html#cb90-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb90-40"><a href="bl1-and-bl2.html#cb90-40" aria-hidden="true" tabindex="-1"></a>  my_theme</span>
<span id="cb90-41"><a href="bl1-and-bl2.html#cb90-41" aria-hidden="true" tabindex="-1"></a>bl1_lfoci_umap_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bl1_spatial_sections-3.png" width="672" /></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb91-1"><a href="bl1-and-bl2.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting consensus heatmap with a frequency annotation of sectors by </span></span>
<span id="cb91-2"><a href="bl1-and-bl2.html#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co"># subclone and annotating genes of interest</span></span>
<span id="cb91-3"><a href="bl1-and-bl2.html#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(bl1, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>, <span class="at">consensus =</span> T, <span class="at">group =</span> <span class="st">&#39;sectors&#39;</span>,</span>
<span id="cb91-4"><a href="bl1-and-bl2.html#cb91-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">genes =</span> <span class="fu">c</span>(</span>
<span id="cb91-5"><a href="bl1-and-bl2.html#cb91-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;FHIT&quot;</span>,</span>
<span id="cb91-6"><a href="bl1-and-bl2.html#cb91-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;CUX1&quot;</span>,</span>
<span id="cb91-7"><a href="bl1-and-bl2.html#cb91-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;WWOX&quot;</span>,</span>
<span id="cb91-8"><a href="bl1-and-bl2.html#cb91-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;FOXO1&quot;</span>,</span>
<span id="cb91-9"><a href="bl1-and-bl2.html#cb91-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;APC&quot;</span>,</span>
<span id="cb91-10"><a href="bl1-and-bl2.html#cb91-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;BCL2&quot;</span>,</span>
<span id="cb91-11"><a href="bl1-and-bl2.html#cb91-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;KRAS&quot;</span>,</span>
<span id="cb91-12"><a href="bl1-and-bl2.html#cb91-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;PGR&quot;</span>,</span>
<span id="cb91-13"><a href="bl1-and-bl2.html#cb91-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;PDGFRA&quot;</span>,</span>
<span id="cb91-14"><a href="bl1-and-bl2.html#cb91-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;ROS1&quot;</span>,</span>
<span id="cb91-15"><a href="bl1-and-bl2.html#cb91-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;PTPN11&quot;</span>,</span>
<span id="cb91-16"><a href="bl1-and-bl2.html#cb91-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;CCND1&quot;</span>,</span>
<span id="cb91-17"><a href="bl1-and-bl2.html#cb91-17" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;BTG1&quot;</span>,</span>
<span id="cb91-18"><a href="bl1-and-bl2.html#cb91-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;FGFR3&quot;</span>,</span>
<span id="cb91-19"><a href="bl1-and-bl2.html#cb91-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;PTEN&quot;</span>,</span>
<span id="cb91-20"><a href="bl1-and-bl2.html#cb91-20" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;FGFR2&quot;</span></span>
<span id="cb91-21"><a href="bl1-and-bl2.html#cb91-21" aria-hidden="true" tabindex="-1"></a>            ))</span></code></pre></div>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="_main_files/figure-html/bl1_spatial_sections-4.png" width="672" /></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb93-1"><a href="bl1-and-bl2.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating Diversity Indexes by sector</span></span>
<span id="cb93-2"><a href="bl1-and-bl2.html#cb93-2" aria-hidden="true" tabindex="-1"></a>bl1_meta <span class="ot">&lt;-</span> <span class="fu">colData</span>(bl1)</span>
<span id="cb93-3"><a href="bl1-and-bl2.html#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="bl1-and-bl2.html#cb93-4" aria-hidden="true" tabindex="-1"></a>bl1_meta <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(bl1_meta)</span>
<span id="cb93-5"><a href="bl1-and-bl2.html#cb93-5" aria-hidden="true" tabindex="-1"></a>bl1_meta <span class="ot">&lt;-</span> bl1_meta[<span class="fu">c</span>(<span class="st">&#39;subclones&#39;</span>, <span class="st">&#39;sectors&#39;</span>)]</span>
<span id="cb93-6"><a href="bl1-and-bl2.html#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="bl1-and-bl2.html#cb93-7" aria-hidden="true" tabindex="-1"></a>bl1_L1_div <span class="ot">&lt;-</span> <span class="fu">shan_sample</span>(bl1_meta, <span class="st">&quot;S1&quot;</span>)</span>
<span id="cb93-8"><a href="bl1-and-bl2.html#cb93-8" aria-hidden="true" tabindex="-1"></a>bl1_L2_div <span class="ot">&lt;-</span> <span class="fu">shan_sample</span>(bl1_meta, <span class="st">&quot;S2&quot;</span>)</span>
<span id="cb93-9"><a href="bl1-and-bl2.html#cb93-9" aria-hidden="true" tabindex="-1"></a>bl1_L3_div <span class="ot">&lt;-</span> <span class="fu">shan_sample</span>(bl1_meta, <span class="st">&quot;S3&quot;</span>)</span>
<span id="cb93-10"><a href="bl1-and-bl2.html#cb93-10" aria-hidden="true" tabindex="-1"></a>bl1_L4L5_div <span class="ot">&lt;-</span> <span class="fu">shan_sample</span>(bl1_meta, <span class="st">&quot;S4S5&quot;</span>)</span>
<span id="cb93-11"><a href="bl1-and-bl2.html#cb93-11" aria-hidden="true" tabindex="-1"></a>bl1_L6L7_div <span class="ot">&lt;-</span> <span class="fu">shan_sample</span>(bl1_meta, <span class="st">&quot;S6S7&quot;</span>)</span>
<span id="cb93-12"><a href="bl1-and-bl2.html#cb93-12" aria-hidden="true" tabindex="-1"></a>bl1_L8L9_div <span class="ot">&lt;-</span> <span class="fu">shan_sample</span>(bl1_meta, <span class="st">&quot;S8S9&quot;</span>)</span>
<span id="cb93-13"><a href="bl1-and-bl2.html#cb93-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-14"><a href="bl1-and-bl2.html#cb93-14" aria-hidden="true" tabindex="-1"></a>bl1_div <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb93-15"><a href="bl1-and-bl2.html#cb93-15" aria-hidden="true" tabindex="-1"></a>  bl1_L1_div,</span>
<span id="cb93-16"><a href="bl1-and-bl2.html#cb93-16" aria-hidden="true" tabindex="-1"></a>  bl1_L2_div,</span>
<span id="cb93-17"><a href="bl1-and-bl2.html#cb93-17" aria-hidden="true" tabindex="-1"></a>  bl1_L3_div,</span>
<span id="cb93-18"><a href="bl1-and-bl2.html#cb93-18" aria-hidden="true" tabindex="-1"></a>  bl1_L4L5_div,</span>
<span id="cb93-19"><a href="bl1-and-bl2.html#cb93-19" aria-hidden="true" tabindex="-1"></a>  bl1_L6L7_div,</span>
<span id="cb93-20"><a href="bl1-and-bl2.html#cb93-20" aria-hidden="true" tabindex="-1"></a>  bl1_L8L9_div</span>
<span id="cb93-21"><a href="bl1-and-bl2.html#cb93-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb93-22"><a href="bl1-and-bl2.html#cb93-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-23"><a href="bl1-and-bl2.html#cb93-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Shannon Diversity Index</span></span>
<span id="cb93-24"><a href="bl1-and-bl2.html#cb93-24" aria-hidden="true" tabindex="-1"></a>bl1_div_p <span class="ot">&lt;-</span> bl1_div <span class="sc">%&gt;%</span></span>
<span id="cb93-25"><a href="bl1-and-bl2.html#cb93-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb93-26"><a href="bl1-and-bl2.html#cb93-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(</span>
<span id="cb93-27"><a href="bl1-and-bl2.html#cb93-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">fct_reorder</span>(foci, div),</span>
<span id="cb93-28"><a href="bl1-and-bl2.html#cb93-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> lci,</span>
<span id="cb93-29"><a href="bl1-and-bl2.html#cb93-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> uci</span>
<span id="cb93-30"><a href="bl1-and-bl2.html#cb93-30" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb93-31"><a href="bl1-and-bl2.html#cb93-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> .<span class="dv">1</span>,</span>
<span id="cb93-32"><a href="bl1-and-bl2.html#cb93-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb93-33"><a href="bl1-and-bl2.html#cb93-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb93-34"><a href="bl1-and-bl2.html#cb93-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">fct_reorder</span>(foci, div),</span>
<span id="cb93-35"><a href="bl1-and-bl2.html#cb93-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> div,</span>
<span id="cb93-36"><a href="bl1-and-bl2.html#cb93-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> foci</span>
<span id="cb93-37"><a href="bl1-and-bl2.html#cb93-37" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb93-38"><a href="bl1-and-bl2.html#cb93-38" aria-hidden="true" tabindex="-1"></a>  cowplot<span class="sc">::</span><span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb93-39"><a href="bl1-and-bl2.html#cb93-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb93-40"><a href="bl1-and-bl2.html#cb93-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb93-41"><a href="bl1-and-bl2.html#cb93-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb93-42"><a href="bl1-and-bl2.html#cb93-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">vjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb93-43"><a href="bl1-and-bl2.html#cb93-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb93-44"><a href="bl1-and-bl2.html#cb93-44" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">+</span></span>
<span id="cb93-45"><a href="bl1-and-bl2.html#cb93-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">pretty_breaks</span>(<span class="at">n =</span> <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb93-46"><a href="bl1-and-bl2.html#cb93-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;shannon diversity index&quot;</span>) <span class="sc">+</span></span>
<span id="cb93-47"><a href="bl1-and-bl2.html#cb93-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb93-48"><a href="bl1-and-bl2.html#cb93-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb93-49"><a href="bl1-and-bl2.html#cb93-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-50"><a href="bl1-and-bl2.html#cb93-50" aria-hidden="true" tabindex="-1"></a>bl1_div_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bl1_spatial_sections-5.png" width="672" /></p>
</div>
</div>
<div id="bl2" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> BL2</h2>
<div id="filtering-1" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Filtering</h3>
<div class="sourceCode" id="cb94"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb94-1"><a href="bl1-and-bl2.html#cb94-1" aria-hidden="true" tabindex="-1"></a>bl2 <span class="ot">&lt;-</span> <span class="fu">runVarbin</span>(<span class="st">&quot;/mnt/lab/users/dminussi/projects/CopyKit_Manuscript_Code/datasets/BL2/marked_bams/&quot;</span>, <span class="at">remove_Y =</span> T)</span></code></pre></div>
<pre><code>## Counting reads for genome hg38 and resolution: 220kb</code></pre>
<pre><code>## 61 bam files had less than 10 mean bincounts and were removed.</code></pre>
<pre><code>## Performing GC correction.</code></pre>
<pre><code>## Smoothing bin counts.</code></pre>
<pre><code>## Running segmentation algorithm: CBS for genome hg38</code></pre>
<pre><code>## Merging levels.</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb102-1"><a href="bl1-and-bl2.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding diploid cells and sub-setting the copykit object</span></span>
<span id="cb102-2"><a href="bl1-and-bl2.html#cb102-2" aria-hidden="true" tabindex="-1"></a>bl2 <span class="ot">&lt;-</span> <span class="fu">findAneuploidCells</span>(bl2)</span></code></pre></div>
<pre><code>## number of iterations= 24</code></pre>
<pre><code>## Copykit detected 100 that are possibly diploid cells using a resolution of: 0.068</code></pre>
<pre><code>## Added information to colData(CopyKit).</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb106-1"><a href="bl1-and-bl2.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(bl2, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&#39;is_aneuploid&#39;</span>),</span>
<span id="cb106-2"><a href="bl1-and-bl2.html#cb106-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">row_split =</span> <span class="st">&#39;is_aneuploid&#39;</span>,</span>
<span id="cb106-3"><a href="bl1-and-bl2.html#cb106-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_threads =</span> <span class="dv">50</span>)</span></code></pre></div>
<pre><code>## Ordering by consensus requires cluster information.</code></pre>
<pre><code>## Switching to hclust.</code></pre>
<pre><code>## No distance matrix detected in the scCNA object.</code></pre>
<pre><code>## Calculating distance matrix with metric: euclidean</code></pre>
<pre><code>## Using 50 cores.</code></pre>
<pre><code>## Access distance matrix with copykit::distMat()</code></pre>
<pre><code>## Done.</code></pre>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-4-1.png" width="768" /></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb115-1"><a href="bl1-and-bl2.html#cb115-1" aria-hidden="true" tabindex="-1"></a>bl2 <span class="ot">&lt;-</span> bl2[,<span class="fu">colData</span>(bl2)<span class="sc">$</span>is_aneuploid <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb115-2"><a href="bl1-and-bl2.html#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="bl1-and-bl2.html#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding low-quality cells</span></span>
<span id="cb115-4"><a href="bl1-and-bl2.html#cb115-4" aria-hidden="true" tabindex="-1"></a>bl2 <span class="ot">&lt;-</span> <span class="fu">findOutliers</span>(bl2)</span></code></pre></div>
<pre><code>## Calculating correlation matrix.</code></pre>
<pre><code>## Marked 108 cells as outliers.</code></pre>
<pre><code>## Adding information to metadata. Access with colData(scCNA).</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb120-1"><a href="bl1-and-bl2.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(bl2, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&#39;outlier&#39;</span>),</span>
<span id="cb120-2"><a href="bl1-and-bl2.html#cb120-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">row_split =</span> <span class="st">&#39;outlier&#39;</span>,</span>
<span id="cb120-3"><a href="bl1-and-bl2.html#cb120-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_threads =</span> <span class="dv">50</span>)</span></code></pre></div>
<pre><code>## Ordering by consensus requires cluster information.</code></pre>
<pre><code>## Switching to hclust.</code></pre>
<pre><code>## No distance matrix detected in the scCNA object.</code></pre>
<pre><code>## Calculating distance matrix with metric: euclidean</code></pre>
<pre><code>## Using 50 cores.</code></pre>
<pre><code>## Access distance matrix with copykit::distMat()</code></pre>
<pre><code>## Done.</code></pre>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-4-2.png" width="768" /></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb129-1"><a href="bl1-and-bl2.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># obtaining metrics and plotting</span></span>
<span id="cb129-2"><a href="bl1-and-bl2.html#cb129-2" aria-hidden="true" tabindex="-1"></a>bl2 <span class="ot">&lt;-</span> <span class="fu">runMetrics</span>(bl2)</span></code></pre></div>
<pre><code>## Calculating overdispersion.</code></pre>
<pre><code>## Counting breakpoints.</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb133-1"><a href="bl1-and-bl2.html#cb133-1" aria-hidden="true" tabindex="-1"></a>bl2_p_metrics <span class="ot">&lt;-</span> <span class="fu">plotMetrics</span>(</span>
<span id="cb133-2"><a href="bl1-and-bl2.html#cb133-2" aria-hidden="true" tabindex="-1"></a>  bl2,</span>
<span id="cb133-3"><a href="bl1-and-bl2.html#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="fu">c</span>(</span>
<span id="cb133-4"><a href="bl1-and-bl2.html#cb133-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;reads_total&quot;</span>,</span>
<span id="cb133-5"><a href="bl1-and-bl2.html#cb133-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;percentage_duplicates&quot;</span>,</span>
<span id="cb133-6"><a href="bl1-and-bl2.html#cb133-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;overdispersion&quot;</span>,</span>
<span id="cb133-7"><a href="bl1-and-bl2.html#cb133-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;breakpoint_count&quot;</span></span>
<span id="cb133-8"><a href="bl1-and-bl2.html#cb133-8" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">label =</span> <span class="st">&#39;outlier&#39;</span>,</span>
<span id="cb133-9"><a href="bl1-and-bl2.html#cb133-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dodge.width =</span> <span class="fl">0.8</span>,</span>
<span id="cb133-10"><a href="bl1-and-bl2.html#cb133-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb133-11"><a href="bl1-and-bl2.html#cb133-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;TRUE&quot;</span> <span class="ot">=</span> <span class="st">&quot;#DA614D&quot;</span>,</span>
<span id="cb133-12"><a href="bl1-and-bl2.html#cb133-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;FALSE&quot;</span> <span class="ot">=</span> <span class="st">&quot;#5F917A&quot;</span>))</span></code></pre></div>
<pre><code>## Coloring by: outlier</code></pre>
<pre><code>## Scale for &#39;fill&#39; is already present. Adding another scale for &#39;fill&#39;, which will replace the existing
## scale.</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb136-1"><a href="bl1-and-bl2.html#cb136-1" aria-hidden="true" tabindex="-1"></a>bl2_p_metrics</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-4-3.png" width="768" /></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb137-1"><a href="bl1-and-bl2.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculating averages from the colData information and statistics</span></span>
<span id="cb137-2"><a href="bl1-and-bl2.html#cb137-2" aria-hidden="true" tabindex="-1"></a>bl2_metrics <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(bl2))</span>
<span id="cb137-3"><a href="bl1-and-bl2.html#cb137-3" aria-hidden="true" tabindex="-1"></a>bl2_metrics <span class="sc">%&gt;%</span></span>
<span id="cb137-4"><a href="bl1-and-bl2.html#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">reads_total_mean =</span> <span class="fu">mean</span>(reads_total),</span>
<span id="cb137-5"><a href="bl1-and-bl2.html#cb137-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">reads_total_sd =</span> <span class="fu">sd</span>(reads_total),</span>
<span id="cb137-6"><a href="bl1-and-bl2.html#cb137-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">percent_dup_mean =</span> <span class="fu">mean</span>(percentage_duplicates),</span>
<span id="cb137-7"><a href="bl1-and-bl2.html#cb137-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">percent_dup_sd =</span> <span class="fu">sd</span>(percentage_duplicates)</span>
<span id="cb137-8"><a href="bl1-and-bl2.html#cb137-8" aria-hidden="true" tabindex="-1"></a>            )</span></code></pre></div>
<pre><code>##   reads_total_mean reads_total_sd percent_dup_mean percent_dup_sd
## 1         975057.5       303911.9       0.08932727     0.01065848</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb139-1"><a href="bl1-and-bl2.html#cb139-1" aria-hidden="true" tabindex="-1"></a>bl2_metrics <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-2"><a href="bl1-and-bl2.html#cb139-2" aria-hidden="true" tabindex="-1"></a>  rstatix<span class="sc">::</span><span class="fu">kruskal_test</span>(overdispersion <span class="sc">~</span> outlier)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   .y.                n statistic    df             p method        
## * &lt;chr&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt;         
## 1 overdispersion  1375      32.9     1 0.00000000978 Kruskal-Wallis</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb141-1"><a href="bl1-and-bl2.html#cb141-1" aria-hidden="true" tabindex="-1"></a>bl2_metrics <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb141-2"><a href="bl1-and-bl2.html#cb141-2" aria-hidden="true" tabindex="-1"></a>  rstatix<span class="sc">::</span><span class="fu">kruskal_test</span>(breakpoint_count <span class="sc">~</span> outlier)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   .y.                  n statistic    df     p method        
## * &lt;chr&gt;            &lt;int&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         
## 1 breakpoint_count  1375     0.928     1 0.335 Kruskal-Wallis</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb143-1"><a href="bl1-and-bl2.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># removing low-quality cells</span></span>
<span id="cb143-2"><a href="bl1-and-bl2.html#cb143-2" aria-hidden="true" tabindex="-1"></a>bl2 <span class="ot">&lt;-</span> bl2[,<span class="fu">colData</span>(bl2)<span class="sc">$</span>outlier <span class="sc">==</span> <span class="cn">FALSE</span>]</span></code></pre></div>
</div>
<div id="umap-and-clustering-1" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> UMAP and clustering</h3>
<div class="sourceCode" id="cb144"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb144-1"><a href="bl1-and-bl2.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Running UMAP and storing into the copykit object</span></span>
<span id="cb144-2"><a href="bl1-and-bl2.html#cb144-2" aria-hidden="true" tabindex="-1"></a>bl2 <span class="ot">&lt;-</span> <span class="fu">runUmap</span>(bl2)</span></code></pre></div>
<pre><code>## Using assay: logr</code></pre>
<pre><code>## Embedding data with UMAP. Using seed 17</code></pre>
<pre><code>## Access reduced dimensions slot with: reducedDim(scCNA, &#39;umap&#39;).</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb149-1"><a href="bl1-and-bl2.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid Search of Jaccard Similarity (cluster stability)</span></span>
<span id="cb149-2"><a href="bl1-and-bl2.html#cb149-2" aria-hidden="true" tabindex="-1"></a>bl2 <span class="ot">&lt;-</span> <span class="fu">findSuggestedK</span>(bl2)</span></code></pre></div>
<pre><code>## Calculating jaccard similarity for k range: 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36</code></pre>
<pre><code>## </code></pre>
<pre><code>## Suggested k = 11 with median jaccard similarity of: 0.928</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb153-1"><a href="bl1-and-bl2.html#cb153-1" aria-hidden="true" tabindex="-1"></a>bl2_primary_suggestedK_p <span class="ot">&lt;-</span> <span class="fu">plotSuggestedK</span>(bl2)</span>
<span id="cb153-2"><a href="bl1-and-bl2.html#cb153-2" aria-hidden="true" tabindex="-1"></a>bl2_primary_suggestedK_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bl2_umap_cl-1.png" width="672" /></p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb154-1"><a href="bl1-and-bl2.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding clusters using the suggested k value as per default settings, </span></span>
<span id="cb154-2"><a href="bl1-and-bl2.html#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="co"># can be changed with the argument k_subclones</span></span>
<span id="cb154-3"><a href="bl1-and-bl2.html#cb154-3" aria-hidden="true" tabindex="-1"></a>bl2 <span class="ot">&lt;-</span> <span class="fu">findClusters</span>(bl2)</span></code></pre></div>
<pre><code>## Using suggested k_subclones = 11</code></pre>
<pre><code>## Finding clusters, using method: hdbscan</code></pre>
<pre><code>## Found 62 outliers cells (group &#39;c0&#39;)</code></pre>
<pre><code>## Found 19 subclones.</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb160-1"><a href="bl1-and-bl2.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HDBSCAN is an outlier aware clustering algorithm</span></span>
<span id="cb160-2"><a href="bl1-and-bl2.html#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in this analysis all cells marked as outliers (c0) from hdbscan are excluded.</span></span>
<span id="cb160-3"><a href="bl1-and-bl2.html#cb160-3" aria-hidden="true" tabindex="-1"></a>bl2 <span class="ot">&lt;-</span> bl2[,<span class="fu">colData</span>(bl2)<span class="sc">$</span>subclones <span class="sc">!=</span> <span class="st">&#39;c0&#39;</span>]</span>
<span id="cb160-4"><a href="bl1-and-bl2.html#cb160-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-5"><a href="bl1-and-bl2.html#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting UMAP colored by subclones</span></span>
<span id="cb160-6"><a href="bl1-and-bl2.html#cb160-6" aria-hidden="true" tabindex="-1"></a>bl2_umap_p <span class="ot">&lt;-</span> <span class="fu">plotUmap</span>(bl2, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.</code></pre>
<pre><code>## Coloring by: subclones.</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb163-1"><a href="bl1-and-bl2.html#cb163-1" aria-hidden="true" tabindex="-1"></a>bl2_umap_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bl2_umap_cl-2.png" width="672" /></p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb164-1"><a href="bl1-and-bl2.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating consensus matrix and consensus phylo, </span></span>
<span id="cb164-2"><a href="bl1-and-bl2.html#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this will be used by copykit to order the subclones on the heatmap</span></span>
<span id="cb164-3"><a href="bl1-and-bl2.html#cb164-3" aria-hidden="true" tabindex="-1"></a>bl2 <span class="ot">&lt;-</span> <span class="fu">calcConsensus</span>(bl2)</span>
<span id="cb164-4"><a href="bl1-and-bl2.html#cb164-4" aria-hidden="true" tabindex="-1"></a>bl2 <span class="ot">&lt;-</span> <span class="fu">runConsensusPhylo</span>(bl2)</span></code></pre></div>
</div>
<div id="subclones-heatmap-1" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Subclones Heatmap</h3>
<div class="sourceCode" id="cb165"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb165-1"><a href="bl1-and-bl2.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting copy number heatmap and annotating with subclones</span></span>
<span id="cb165-2"><a href="bl1-and-bl2.html#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(bl2, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&#39;subclones&#39;</span>))</span></code></pre></div>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="_main_files/figure-html/bl2_subclones-1.png" width="768" /></p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb167-1"><a href="bl1-and-bl2.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding macro-spatial information from file names to colData</span></span>
<span id="cb167-2"><a href="bl1-and-bl2.html#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and renaming to (S)ectors</span></span>
<span id="cb167-3"><a href="bl1-and-bl2.html#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(bl2)<span class="sc">$</span>sectors <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="fu">colData</span>(bl2)<span class="sc">$</span>sample,</span>
<span id="cb167-4"><a href="bl1-and-bl2.html#cb167-4" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">&quot;L[0-9]+&quot;</span>)</span>
<span id="cb167-5"><a href="bl1-and-bl2.html#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(bl2)<span class="sc">$</span>sectors <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="fu">colData</span>(bl2)<span class="sc">$</span>sectors, </span>
<span id="cb167-6"><a href="bl1-and-bl2.html#cb167-6" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">&quot;L&quot;</span>, <span class="st">&quot;S&quot;</span>)</span>
<span id="cb167-7"><a href="bl1-and-bl2.html#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the UMAP colored by sectors</span></span>
<span id="cb167-8"><a href="bl1-and-bl2.html#cb167-8" aria-hidden="true" tabindex="-1"></a>bl2_umap_sectors_p <span class="ot">&lt;-</span> <span class="fu">plotUmap</span>(bl2, <span class="at">label =</span> <span class="st">&#39;sectors&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.</code></pre>
<pre><code>## Coloring by: sectors.</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb170-1"><a href="bl1-and-bl2.html#cb170-1" aria-hidden="true" tabindex="-1"></a>bl2_umap_sectors_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bl2_spatial_sections-1.png" width="672" /></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb171-1"><a href="bl1-and-bl2.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating pie charts plots of the proportions of clones on each sector</span></span>
<span id="cb171-2"><a href="bl1-and-bl2.html#cb171-2" aria-hidden="true" tabindex="-1"></a>bl2_focis <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">colData</span>(bl2)<span class="sc">$</span>sectors)</span>
<span id="cb171-3"><a href="bl1-and-bl2.html#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="bl1-and-bl2.html#cb171-4" aria-hidden="true" tabindex="-1"></a>bl2_foci_pies <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb171-5"><a href="bl1-and-bl2.html#cb171-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-6"><a href="bl1-and-bl2.html#cb171-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(bl2_focis)) {</span>
<span id="cb171-7"><a href="bl1-and-bl2.html#cb171-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-8"><a href="bl1-and-bl2.html#cb171-8" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(bl2)) <span class="sc">%&gt;%</span></span>
<span id="cb171-9"><a href="bl1-and-bl2.html#cb171-9" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(sectors <span class="sc">==</span> bl2_focis[i])</span>
<span id="cb171-10"><a href="bl1-and-bl2.html#cb171-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-11"><a href="bl1-and-bl2.html#cb171-11" aria-hidden="true" tabindex="-1"></a>  bl2_foci_pies[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb171-12"><a href="bl1-and-bl2.html#cb171-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> sectors, <span class="at">fill =</span> subclones),</span>
<span id="cb171-13"><a href="bl1-and-bl2.html#cb171-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="sc">+</span></span>
<span id="cb171-14"><a href="bl1-and-bl2.html#cb171-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb171-15"><a href="bl1-and-bl2.html#cb171-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">subclones_pal</span>(),</span>
<span id="cb171-16"><a href="bl1-and-bl2.html#cb171-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">limits =</span> force) <span class="sc">+</span></span>
<span id="cb171-17"><a href="bl1-and-bl2.html#cb171-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb171-18"><a href="bl1-and-bl2.html#cb171-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(bl2_focis[i])</span>
<span id="cb171-19"><a href="bl1-and-bl2.html#cb171-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-20"><a href="bl1-and-bl2.html#cb171-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb171-21"><a href="bl1-and-bl2.html#cb171-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-22"><a href="bl1-and-bl2.html#cb171-22" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(bl2_foci_pies)</span></code></pre></div>
<p><img src="_main_files/figure-html/bl2_spatial_sections-2.png" width="672" /></p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb172-1"><a href="bl1-and-bl2.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting up a theme for the next plot</span></span>
<span id="cb172-2"><a href="bl1-and-bl2.html#cb172-2" aria-hidden="true" tabindex="-1"></a>my_theme <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb172-3"><a href="bl1-and-bl2.html#cb172-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb172-4"><a href="bl1-and-bl2.html#cb172-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;gray28&quot;</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb172-5"><a href="bl1-and-bl2.html#cb172-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb172-6"><a href="bl1-and-bl2.html#cb172-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb172-7"><a href="bl1-and-bl2.html#cb172-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;gray28&quot;</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb172-8"><a href="bl1-and-bl2.html#cb172-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb172-9"><a href="bl1-and-bl2.html#cb172-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb172-10"><a href="bl1-and-bl2.html#cb172-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb172-11"><a href="bl1-and-bl2.html#cb172-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb172-12"><a href="bl1-and-bl2.html#cb172-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&#39;black&#39;</span>)</span>
<span id="cb172-13"><a href="bl1-and-bl2.html#cb172-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb172-14"><a href="bl1-and-bl2.html#cb172-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;umap1&quot;</span>),</span>
<span id="cb172-15"><a href="bl1-and-bl2.html#cb172-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;umap2&quot;</span>)</span>
<span id="cb172-16"><a href="bl1-and-bl2.html#cb172-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb172-17"><a href="bl1-and-bl2.html#cb172-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-18"><a href="bl1-and-bl2.html#cb172-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the UMAP colored by sector and using ggrepel to label the subclones</span></span>
<span id="cb172-19"><a href="bl1-and-bl2.html#cb172-19" aria-hidden="true" tabindex="-1"></a>bl2_lfoci_umap <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">reducedDim</span>(bl2, <span class="st">&#39;umap&#39;</span>))</span>
<span id="cb172-20"><a href="bl1-and-bl2.html#cb172-20" aria-hidden="true" tabindex="-1"></a>bl2_lfoci_umap<span class="sc">$</span>sectors <span class="ot">&lt;-</span> <span class="fu">colData</span>(bl2)<span class="sc">$</span>sectors</span>
<span id="cb172-21"><a href="bl1-and-bl2.html#cb172-21" aria-hidden="true" tabindex="-1"></a>bl2_lfoci_umap<span class="sc">$</span>subclones <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">colData</span>(bl2)<span class="sc">$</span>subclones)</span>
<span id="cb172-22"><a href="bl1-and-bl2.html#cb172-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Avoiding overplotting of text</span></span>
<span id="cb172-23"><a href="bl1-and-bl2.html#cb172-23" aria-hidden="true" tabindex="-1"></a>bl2_lfoci_umap<span class="sc">$</span>subclones <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">duplicated</span>(bl2_lfoci_umap<span class="sc">$</span>subclones),</span>
<span id="cb172-24"><a href="bl1-and-bl2.html#cb172-24" aria-hidden="true" tabindex="-1"></a>                                   bl2_lfoci_umap<span class="sc">$</span>subclones, <span class="st">&quot;&quot;</span>)</span>
<span id="cb172-25"><a href="bl1-and-bl2.html#cb172-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-26"><a href="bl1-and-bl2.html#cb172-26" aria-hidden="true" tabindex="-1"></a>bl2_lfoci_umap_p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bl2_lfoci_umap, <span class="fu">aes</span>(V1, V2, <span class="at">label =</span> subclones)) <span class="sc">+</span></span>
<span id="cb172-27"><a href="bl1-and-bl2.html#cb172-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> sectors), <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb172-28"><a href="bl1-and-bl2.html#cb172-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">stroke =</span> <span class="fl">0.1</span>,</span>
<span id="cb172-29"><a href="bl1-and-bl2.html#cb172-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb172-30"><a href="bl1-and-bl2.html#cb172-30" aria-hidden="true" tabindex="-1"></a>  ggnewscale<span class="sc">::</span><span class="fu">new_scale_fill</span>() <span class="sc">+</span></span>
<span id="cb172-31"><a href="bl1-and-bl2.html#cb172-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">color =</span> subclones),</span>
<span id="cb172-32"><a href="bl1-and-bl2.html#cb172-32" aria-hidden="true" tabindex="-1"></a>                   <span class="at">min.segment.length =</span> <span class="dv">0</span>,</span>
<span id="cb172-33"><a href="bl1-and-bl2.html#cb172-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">box.padding =</span> <span class="fl">0.01</span>,</span>
<span id="cb172-34"><a href="bl1-and-bl2.html#cb172-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb172-35"><a href="bl1-and-bl2.html#cb172-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">max.overlaps =</span> <span class="cn">Inf</span>,</span>
<span id="cb172-36"><a href="bl1-and-bl2.html#cb172-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na.rm =</span> T) <span class="sc">+</span></span>
<span id="cb172-37"><a href="bl1-and-bl2.html#cb172-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">subclones_pal</span>(),</span>
<span id="cb172-38"><a href="bl1-and-bl2.html#cb172-38" aria-hidden="true" tabindex="-1"></a>                    <span class="at">limits =</span> force) <span class="sc">+</span></span>
<span id="cb172-39"><a href="bl1-and-bl2.html#cb172-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb172-40"><a href="bl1-and-bl2.html#cb172-40" aria-hidden="true" tabindex="-1"></a>  my_theme</span>
<span id="cb172-41"><a href="bl1-and-bl2.html#cb172-41" aria-hidden="true" tabindex="-1"></a>bl2_lfoci_umap_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bl2_spatial_sections-3.png" width="672" /></p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb173-1"><a href="bl1-and-bl2.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting consensus heatmap with a frequency annotation of sectors </span></span>
<span id="cb173-2"><a href="bl1-and-bl2.html#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="co"># by subclone and annotating genes of interest</span></span>
<span id="cb173-3"><a href="bl1-and-bl2.html#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(bl2, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>, <span class="at">consensus =</span> T, <span class="at">group =</span> <span class="st">&#39;sectors&#39;</span>,</span>
<span id="cb173-4"><a href="bl1-and-bl2.html#cb173-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">genes =</span> <span class="fu">c</span>(</span>
<span id="cb173-5"><a href="bl1-and-bl2.html#cb173-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;CCND1&quot;</span>,</span>
<span id="cb173-6"><a href="bl1-and-bl2.html#cb173-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;TP53&quot;</span>,</span>
<span id="cb173-7"><a href="bl1-and-bl2.html#cb173-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;GATA1&quot;</span>,</span>
<span id="cb173-8"><a href="bl1-and-bl2.html#cb173-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;SOX2&quot;</span>,</span>
<span id="cb173-9"><a href="bl1-and-bl2.html#cb173-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;ERBB2&quot;</span>,</span>
<span id="cb173-10"><a href="bl1-and-bl2.html#cb173-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;MYC&quot;</span>,</span>
<span id="cb173-11"><a href="bl1-and-bl2.html#cb173-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;RB1&quot;</span>,</span>
<span id="cb173-12"><a href="bl1-and-bl2.html#cb173-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;PIK3CA&quot;</span>,</span>
<span id="cb173-13"><a href="bl1-and-bl2.html#cb173-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;MMP3&quot;</span>,</span>
<span id="cb173-14"><a href="bl1-and-bl2.html#cb173-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;BRCA1&quot;</span>,</span>
<span id="cb173-15"><a href="bl1-and-bl2.html#cb173-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;BRCA2&quot;</span>,</span>
<span id="cb173-16"><a href="bl1-and-bl2.html#cb173-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;FHIT&quot;</span></span>
<span id="cb173-17"><a href="bl1-and-bl2.html#cb173-17" aria-hidden="true" tabindex="-1"></a>            ))</span></code></pre></div>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="_main_files/figure-html/bl2_spatial_sections-4.png" width="672" /></p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb175-1"><a href="bl1-and-bl2.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating Diversity Indexes by sector</span></span>
<span id="cb175-2"><a href="bl1-and-bl2.html#cb175-2" aria-hidden="true" tabindex="-1"></a>bl2_meta <span class="ot">&lt;-</span> <span class="fu">colData</span>(bl2)</span>
<span id="cb175-3"><a href="bl1-and-bl2.html#cb175-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-4"><a href="bl1-and-bl2.html#cb175-4" aria-hidden="true" tabindex="-1"></a>bl2_meta <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(bl2_meta)</span>
<span id="cb175-5"><a href="bl1-and-bl2.html#cb175-5" aria-hidden="true" tabindex="-1"></a>bl2_meta <span class="ot">&lt;-</span> bl2_meta[<span class="fu">c</span>(<span class="st">&#39;subclones&#39;</span>, <span class="st">&#39;sectors&#39;</span>)]</span>
<span id="cb175-6"><a href="bl1-and-bl2.html#cb175-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-7"><a href="bl1-and-bl2.html#cb175-7" aria-hidden="true" tabindex="-1"></a>bl2_L1_div <span class="ot">&lt;-</span> <span class="fu">shan_sample</span>(bl2_meta, <span class="st">&quot;S1&quot;</span>)</span>
<span id="cb175-8"><a href="bl1-and-bl2.html#cb175-8" aria-hidden="true" tabindex="-1"></a>bl2_L4_div <span class="ot">&lt;-</span> <span class="fu">shan_sample</span>(bl2_meta, <span class="st">&quot;S4&quot;</span>)</span>
<span id="cb175-9"><a href="bl1-and-bl2.html#cb175-9" aria-hidden="true" tabindex="-1"></a>bl2_L5_div <span class="ot">&lt;-</span> <span class="fu">shan_sample</span>(bl2_meta, <span class="st">&quot;S5&quot;</span>)</span>
<span id="cb175-10"><a href="bl1-and-bl2.html#cb175-10" aria-hidden="true" tabindex="-1"></a>bl2_L6_div <span class="ot">&lt;-</span> <span class="fu">shan_sample</span>(bl2_meta, <span class="st">&quot;S6&quot;</span>)</span>
<span id="cb175-11"><a href="bl1-and-bl2.html#cb175-11" aria-hidden="true" tabindex="-1"></a>bl2_L7_div <span class="ot">&lt;-</span> <span class="fu">shan_sample</span>(bl2_meta, <span class="st">&quot;S7&quot;</span>)</span>
<span id="cb175-12"><a href="bl1-and-bl2.html#cb175-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-13"><a href="bl1-and-bl2.html#cb175-13" aria-hidden="true" tabindex="-1"></a>bl2_div <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb175-14"><a href="bl1-and-bl2.html#cb175-14" aria-hidden="true" tabindex="-1"></a>  bl2_L1_div,</span>
<span id="cb175-15"><a href="bl1-and-bl2.html#cb175-15" aria-hidden="true" tabindex="-1"></a>  bl2_L4_div,</span>
<span id="cb175-16"><a href="bl1-and-bl2.html#cb175-16" aria-hidden="true" tabindex="-1"></a>  bl2_L5_div,</span>
<span id="cb175-17"><a href="bl1-and-bl2.html#cb175-17" aria-hidden="true" tabindex="-1"></a>  bl2_L6_div,</span>
<span id="cb175-18"><a href="bl1-and-bl2.html#cb175-18" aria-hidden="true" tabindex="-1"></a>  bl2_L7_div</span>
<span id="cb175-19"><a href="bl1-and-bl2.html#cb175-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb175-20"><a href="bl1-and-bl2.html#cb175-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-21"><a href="bl1-and-bl2.html#cb175-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-22"><a href="bl1-and-bl2.html#cb175-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Shannon Diversity Index</span></span>
<span id="cb175-23"><a href="bl1-and-bl2.html#cb175-23" aria-hidden="true" tabindex="-1"></a>bl2_div_p <span class="ot">&lt;-</span> bl2_div <span class="sc">%&gt;%</span></span>
<span id="cb175-24"><a href="bl1-and-bl2.html#cb175-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb175-25"><a href="bl1-and-bl2.html#cb175-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(</span>
<span id="cb175-26"><a href="bl1-and-bl2.html#cb175-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">fct_reorder</span>(foci, div),</span>
<span id="cb175-27"><a href="bl1-and-bl2.html#cb175-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> lci,</span>
<span id="cb175-28"><a href="bl1-and-bl2.html#cb175-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> uci</span>
<span id="cb175-29"><a href="bl1-and-bl2.html#cb175-29" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb175-30"><a href="bl1-and-bl2.html#cb175-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> .<span class="dv">1</span>,</span>
<span id="cb175-31"><a href="bl1-and-bl2.html#cb175-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb175-32"><a href="bl1-and-bl2.html#cb175-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb175-33"><a href="bl1-and-bl2.html#cb175-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">fct_reorder</span>(foci, div),</span>
<span id="cb175-34"><a href="bl1-and-bl2.html#cb175-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> div,</span>
<span id="cb175-35"><a href="bl1-and-bl2.html#cb175-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> foci</span>
<span id="cb175-36"><a href="bl1-and-bl2.html#cb175-36" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb175-37"><a href="bl1-and-bl2.html#cb175-37" aria-hidden="true" tabindex="-1"></a>  cowplot<span class="sc">::</span><span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb175-38"><a href="bl1-and-bl2.html#cb175-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb175-39"><a href="bl1-and-bl2.html#cb175-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb175-40"><a href="bl1-and-bl2.html#cb175-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb175-41"><a href="bl1-and-bl2.html#cb175-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">vjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb175-42"><a href="bl1-and-bl2.html#cb175-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb175-43"><a href="bl1-and-bl2.html#cb175-43" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">+</span></span>
<span id="cb175-44"><a href="bl1-and-bl2.html#cb175-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">pretty_breaks</span>(<span class="at">n =</span> <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb175-45"><a href="bl1-and-bl2.html#cb175-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;shannon diversity index&quot;</span>) <span class="sc">+</span></span>
<span id="cb175-46"><a href="bl1-and-bl2.html#cb175-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb175-47"><a href="bl1-and-bl2.html#cb175-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb175-48"><a href="bl1-and-bl2.html#cb175-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-49"><a href="bl1-and-bl2.html#cb175-49" aria-hidden="true" tabindex="-1"></a>bl2_div_p</span></code></pre></div>
<p><img src="_main_files/figure-html/bl2_spatial_sections-5.png" width="672" /></p>

<p>The following code analysis the breast metastatic sample with metastasis to the liver and to the pleural effusion.
This works as an example on how to employ CopyKit for the analysis of multiple datasets.</p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bm1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/navinlabcode/copykit/blob/master/02-bl1_bl2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
