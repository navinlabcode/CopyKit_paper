<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 CM1 and CM2 | _main.knit</title>
  <meta name="description" content="<p>This is the code from the figures presented in the CopyKit manuscript -
Resolving clonal substructure from single cell genomic data using CopyKit.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="4 CM1 and CM2 | _main.knit" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>This is the code from the figures presented in the CopyKit manuscript -
Resolving clonal substructure from single cell genomic data using CopyKit.</p>" />
  <meta name="github-repo" content="navinlabcode/copykit" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 CM1 and CM2 | _main.knit" />
  
  <meta name="twitter:description" content="<p>This is the code from the figures presented in the CopyKit manuscript -
Resolving clonal substructure from single cell genomic data using CopyKit.</p>" />
  

<meta name="author" content="Darlan Conterno Minussi" />


<meta name="date" content="2022-03-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bm1.html"/>
<link rel="next" href="session-info.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CopyKit Manuscript Code</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html"><i class="fa fa-check"></i><b>2</b> BL1 and BL2</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#bl1"><i class="fa fa-check"></i><b>2.1</b> BL1</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#filtering"><i class="fa fa-check"></i><b>2.1.1</b> Filtering</a></li>
<li class="chapter" data-level="2.1.2" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#umap-and-clustering"><i class="fa fa-check"></i><b>2.1.2</b> UMAP and clustering</a></li>
<li class="chapter" data-level="2.1.3" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#subclones-heatmap"><i class="fa fa-check"></i><b>2.1.3</b> Subclones Heatmap</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#bl2"><i class="fa fa-check"></i><b>2.2</b> BL2</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#filtering-1"><i class="fa fa-check"></i><b>2.2.1</b> Filtering</a></li>
<li class="chapter" data-level="2.2.2" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#umap-and-clustering-1"><i class="fa fa-check"></i><b>2.2.2</b> UMAP and clustering</a></li>
<li class="chapter" data-level="2.2.3" data-path="bl1-and-bl2.html"><a href="bl1-and-bl2.html#subclones-heatmap-1"><i class="fa fa-check"></i><b>2.2.3</b> Subclones Heatmap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bm1.html"><a href="bm1.html"><i class="fa fa-check"></i><b>3</b> BM1</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bm1.html"><a href="bm1.html#reading-datasets"><i class="fa fa-check"></i><b>3.1</b> Reading datasets</a></li>
<li class="chapter" data-level="3.2" data-path="bm1.html"><a href="bm1.html#running-umap-and-clustering"><i class="fa fa-check"></i><b>3.2</b> Running UMAP and Clustering</a></li>
<li class="chapter" data-level="3.3" data-path="bm1.html"><a href="bm1.html#consensus-tree"><i class="fa fa-check"></i><b>3.3</b> Consensus tree</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html"><i class="fa fa-check"></i><b>4</b> CM1 and CM2</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm1"><i class="fa fa-check"></i><b>4.1</b> CM1</a></li>
<li class="chapter" data-level="4.2" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm1-colon"><i class="fa fa-check"></i><b>4.2</b> CM1 colon</a></li>
<li class="chapter" data-level="4.3" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm1-liver"><i class="fa fa-check"></i><b>4.3</b> CM1 liver</a></li>
<li class="chapter" data-level="4.4" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm1-merging"><i class="fa fa-check"></i><b>4.4</b> CM1 merging</a></li>
<li class="chapter" data-level="4.5" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm2"><i class="fa fa-check"></i><b>4.5</b> CM2</a></li>
<li class="chapter" data-level="4.6" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm2-colon"><i class="fa fa-check"></i><b>4.6</b> CM2 colon</a></li>
<li class="chapter" data-level="4.7" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm2-liver"><i class="fa fa-check"></i><b>4.7</b> CM2 liver</a></li>
<li class="chapter" data-level="4.8" data-path="cm1-and-cm2.html"><a href="cm1-and-cm2.html#cm2-merging"><i class="fa fa-check"></i><b>4.8</b> CM2 merging</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="session-info.html"><a href="session-info.html"><i class="fa fa-check"></i><b>5</b> Session Info</a>
<ul>
<li class="chapter" data-level="5.1" data-path="session-info.html"><a href="session-info.html#dockerfile"><i class="fa fa-check"></i><b>5.1</b> Dockerfile</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="copykit-paper.html"><a href="copykit-paper.html"><i class="fa fa-check"></i><b>6</b> CopyKit Paper</a>
<ul>
<li class="chapter" data-level="6.1" data-path="copykit-paper.html"><a href="copykit-paper.html#manuscript-code"><i class="fa fa-check"></i><b>6.1</b> Manuscript Code</a></li>
<li class="chapter" data-level="6.2" data-path="copykit-paper.html"><a href="copykit-paper.html#copykit-installation"><i class="fa fa-check"></i><b>6.2</b> CopyKit installation</a></li>
<li class="chapter" data-level="6.3" data-path="copykit-paper.html"><a href="copykit-paper.html#documentation"><i class="fa fa-check"></i><b>6.3</b> Documentation</a></li>
<li class="chapter" data-level="6.4" data-path="copykit-paper.html"><a href="copykit-paper.html#datasets"><i class="fa fa-check"></i><b>6.4</b> Datasets</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cm1-and-cm2" class="section level1" number="4">
<h1><span class="header-section-number">4</span> CM1 and CM2</h1>
<div id="cm1" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> CM1</h2>
</div>
<div id="cm1-colon" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> CM1 colon</h2>
<div class="sourceCode" id="cb198"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb198-1"><a href="cm1-and-cm2.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Running data with CopyKit for the primary colon sample</span></span>
<span id="cb198-2"><a href="cm1-and-cm2.html#cb198-2" aria-hidden="true" tabindex="-1"></a>cm1_tumor_primary <span class="ot">&lt;-</span> <span class="fu">runVarbin</span>(<span class="st">&quot;/mnt/lab/users/dminussi/projects/CopyKit_Manuscript_Code/datasets/CM1/colon/marked_bams&quot;</span>, <span class="at">remove_Y =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Counting reads for genome hg38 and resolution: 220kb</code></pre>
<pre><code>## 441 bam files had less than 10 mean bincounts and were removed.</code></pre>
<pre><code>## Performing GC correction.</code></pre>
<pre><code>## iteration: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003100410051006100710081009101010111012101310141015101610171018101910201021102210231024102510261027102810291030103110321033103410351036103710381039104010411042104310441045104610471048104910501051105210531054105510561057105810591060106110621063106410651066106710681069107010711072107310741075107610771078107910801081108210831084108510861087108810891090109110921093109410951096109710981099110011011102110311041105110611071108110911101111111211131114111511161117111811191120112111221123112411251126112711281129113011311132113311341135113611371138113911401141114211431144114511461147114811491150115111521153115411551156115711581159116011611162116311641165116611671168116911701171117211731174117511761177117811791180118111821183118411851186118711881189119011911192119311941195119611971198119912001201120212031204120512061207120812091210121112121213121412151216121712181219122012211222122312241225122612271228122912301231123212331234123512361237123812391240124112421243124412451246124712481249125012511252125312541255125612571258125912601261126212631264126512661267126812691270127112721273127412751276127712781279128012811282128312841285128612871288128912901291129212931294129512961297129812991300130113021303130413051306130713081309131013111312131313141315131613171318131913201321132213231324132513261327132813291330133113321333133413351336133713381339134013411342134313441345134613471348134913501351135213531354135513561357135813591360136113621363136413651366136713681369137013711372137313741375137613771378137913801381138213831384138513861387138813891390139113921393139413951396139713981399140014011402140314041405140614071408140914101411141214131414141514161417141814191420142114221423142414251426142714281429143014311432143314341435143614371438143914401441144214431444144514461447144814491450145114521453145414551456145714581459146014611462146314641465146614671468146914701471147214731474147514761477147814791480148114821483148414851486148714881489149014911492149314941495149614971498149915001501150215031504150515061507150815091510151115121513151415151516151715181519152015211522152315241525152615271528152915301531153215331534153515361537153815391540154115421543154415451546154715481549155015511552155315541555155615571558155915601561156215631564156515661567156815691570157115721573157415751576157715781579158015811582158315841585158615871588158915901591159215931594159515961597159815991600160116021603160416051606160716081609161016111612161316141615161616171618161916201621162216231624162516261627162816291630163116321633163416351636163716381639164016411642164316441645164616471648164916501651165216531654165516561657165816591660166116621663166416651666166716681669167016711672167316741675167616771678167916801681168216831684168516861687168816891690169116921693169416951696169716981699170017011702170317041705170617071708170917101711171217131714171517161717171817191720172117221723172417251726172717281729173017311732173317341735173617371738173917401741174217431744174517461747174817491750175117521753175417551756175717581759176017611762176317641765176617671768176917701771177217731774177517761777177817791780178117821783178417851786178717881789179017911792179317941795179617971798179918001801180218031804180518061807180818091810181118121813181418151816181718181819182018211822182318241825182618271828182918301831183218331834183518361837183818391840184118421843184418451846184718481849185018511852185318541855185618571858185918601861186218631864186518661867186818691870187118721873187418751876187718781879188018811882188318841885188618871888188918901891189218931894189518961897189818991900190119021903190419051906190719081909191019111912191319141915191619171918191919201921192219231924192519261927192819291930193119321933193419351936193719381939194019411942194319441945194619471948194919501951195219531954195519561957195819591960196119621963196419651966196719681969197019711972197319741975197619771978197919801981198219831984198519861987198819891990199119921993199419951996199719981999200020012002200320042005200620072008200920102011201220132014201520162017201820192020202120222023202420252026202720282029203020312032203320342035203620372038203920402041204220432044204520462047204820492050205120522053205420552056205720582059206020612062206320642065206620672068206920702071207220732074207520762077207820792080208120822083208420852086208720882089209020912092209320942095209620972098209921002101210221032104210521062107210821092110211121122113211421152116211721182119
## Smoothing bin counts.
## iteration: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003100410051006100710081009101010111012101310141015101610171018101910201021102210231024102510261027102810291030103110321033103410351036103710381039104010411042104310441045104610471048104910501051105210531054105510561057105810591060106110621063106410651066106710681069107010711072107310741075107610771078107910801081108210831084108510861087108810891090109110921093109410951096109710981099110011011102110311041105110611071108110911101111111211131114111511161117111811191120112111221123112411251126112711281129113011311132113311341135113611371138113911401141114211431144114511461147114811491150115111521153115411551156115711581159116011611162116311641165116611671168116911701171117211731174117511761177117811791180118111821183118411851186118711881189119011911192119311941195119611971198119912001201120212031204120512061207120812091210121112121213121412151216121712181219122012211222122312241225122612271228122912301231123212331234123512361237123812391240124112421243124412451246124712481249125012511252125312541255125612571258125912601261126212631264126512661267126812691270127112721273127412751276127712781279128012811282128312841285128612871288128912901291129212931294129512961297129812991300130113021303130413051306130713081309131013111312131313141315131613171318131913201321132213231324132513261327132813291330133113321333133413351336133713381339134013411342134313441345134613471348134913501351135213531354135513561357135813591360136113621363136413651366136713681369137013711372137313741375137613771378137913801381138213831384138513861387138813891390139113921393139413951396139713981399140014011402140314041405140614071408140914101411141214131414141514161417141814191420142114221423142414251426142714281429143014311432143314341435143614371438143914401441144214431444144514461447144814491450145114521453145414551456145714581459146014611462146314641465146614671468146914701471147214731474147514761477147814791480148114821483148414851486148714881489149014911492149314941495149614971498149915001501150215031504150515061507150815091510151115121513151415151516151715181519152015211522152315241525152615271528152915301531153215331534153515361537153815391540154115421543154415451546154715481549155015511552155315541555155615571558155915601561156215631564156515661567156815691570157115721573157415751576157715781579158015811582158315841585158615871588158915901591159215931594159515961597159815991600160116021603160416051606160716081609161016111612161316141615161616171618161916201621162216231624162516261627162816291630163116321633163416351636163716381639164016411642164316441645164616471648164916501651165216531654165516561657165816591660166116621663166416651666166716681669167016711672167316741675167616771678167916801681168216831684168516861687168816891690169116921693169416951696169716981699170017011702170317041705170617071708170917101711171217131714171517161717171817191720172117221723172417251726172717281729173017311732173317341735173617371738173917401741174217431744174517461747174817491750175117521753175417551756175717581759176017611762176317641765176617671768176917701771177217731774177517761777177817791780178117821783178417851786178717881789179017911792179317941795179617971798179918001801180218031804180518061807180818091810181118121813181418151816181718181819182018211822182318241825182618271828182918301831183218331834183518361837183818391840184118421843184418451846184718481849185018511852185318541855185618571858185918601861186218631864186518661867186818691870187118721873187418751876187718781879188018811882188318841885188618871888188918901891189218931894189518961897189818991900190119021903190419051906190719081909191019111912191319141915191619171918191919201921192219231924192519261927192819291930193119321933193419351936193719381939194019411942194319441945194619471948194919501951195219531954195519561957195819591960196119621963196419651966196719681969197019711972197319741975197619771978197919801981198219831984198519861987198819891990199119921993199419951996199719981999200020012002200320042005200620072008200920102011201220132014201520162017201820192020202120222023202420252026202720282029203020312032203320342035203620372038203920402041204220432044204520462047204820492050205120522053205420552056205720582059206020612062206320642065206620672068206920702071207220732074207520762077207820792080208120822083208420852086208720882089209020912092209320942095209620972098209921002101210221032104210521062107210821092110211121122113211421152116211721182119
## Running segmentation algorithm: CBS for genome hg38
## iteration: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003100410051006100710081009101010111012101310141015101610171018101910201021102210231024102510261027102810291030103110321033103410351036103710381039104010411042104310441045104610471048104910501051105210531054105510561057105810591060106110621063106410651066106710681069107010711072107310741075107610771078107910801081108210831084108510861087108810891090109110921093109410951096109710981099110011011102110311041105110611071108110911101111111211131114111511161117111811191120112111221123112411251126112711281129113011311132113311341135113611371138113911401141114211431144114511461147114811491150115111521153115411551156115711581159116011611162116311641165116611671168116911701171117211731174117511761177117811791180118111821183118411851186118711881189119011911192119311941195119611971198119912001201120212031204120512061207120812091210121112121213121412151216121712181219122012211222122312241225122612271228122912301231123212331234123512361237123812391240124112421243124412451246124712481249125012511252125312541255125612571258125912601261126212631264126512661267126812691270127112721273127412751276127712781279128012811282128312841285128612871288128912901291129212931294129512961297129812991300130113021303130413051306130713081309131013111312131313141315131613171318131913201321132213231324132513261327132813291330133113321333133413351336133713381339134013411342134313441345134613471348134913501351135213531354135513561357135813591360136113621363136413651366136713681369137013711372137313741375137613771378137913801381138213831384138513861387138813891390139113921393139413951396139713981399140014011402140314041405140614071408140914101411141214131414141514161417141814191420142114221423142414251426142714281429143014311432143314341435143614371438143914401441144214431444144514461447144814491450145114521453145414551456145714581459146014611462146314641465146614671468146914701471147214731474147514761477147814791480148114821483148414851486148714881489149014911492149314941495149614971498149915001501150215031504150515061507150815091510151115121513151415151516151715181519152015211522152315241525152615271528152915301531153215331534153515361537153815391540154115421543154415451546154715481549155015511552155315541555155615571558155915601561156215631564156515661567156815691570157115721573157415751576157715781579158015811582158315841585158615871588158915901591159215931594159515961597159815991600160116021603160416051606160716081609161016111612161316141615161616171618161916201621162216231624162516261627162816291630163116321633163416351636163716381639164016411642164316441645164616471648164916501651165216531654165516561657165816591660166116621663166416651666166716681669167016711672167316741675167616771678167916801681168216831684168516861687168816891690169116921693169416951696169716981699170017011702170317041705170617071708170917101711171217131714171517161717171817191720172117221723172417251726172717281729173017311732173317341735173617371738173917401741174217431744174517461747174817491750175117521753175417551756175717581759176017611762176317641765176617671768176917701771177217731774177517761777177817791780178117821783178417851786178717881789179017911792179317941795179617971798179918001801180218031804180518061807180818091810181118121813181418151816181718181819182018211822182318241825182618271828182918301831183218331834183518361837183818391840184118421843184418451846184718481849185018511852185318541855185618571858185918601861186218631864186518661867186818691870187118721873187418751876187718781879188018811882188318841885188618871888188918901891189218931894189518961897189818991900190119021903190419051906190719081909191019111912191319141915191619171918191919201921192219231924192519261927192819291930193119321933193419351936193719381939194019411942194319441945194619471948194919501951195219531954195519561957195819591960196119621963196419651966196719681969197019711972197319741975197619771978197919801981198219831984198519861987198819891990199119921993199419951996199719981999200020012002200320042005200620072008200920102011201220132014201520162017201820192020202120222023202420252026202720282029203020312032203320342035203620372038203920402041204220432044204520462047204820492050205120522053205420552056205720582059206020612062206320642065206620672068206920702071207220732074207520762077207820792080208120822083208420852086208720882089209020912092209320942095209620972098209921002101210221032104210521062107210821092110211121122113211421152116211721182119
## Merging levels.
## iteration: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003100410051006100710081009101010111012101310141015101610171018101910201021102210231024102510261027102810291030103110321033103410351036103710381039104010411042104310441045104610471048104910501051105210531054105510561057105810591060106110621063106410651066106710681069107010711072107310741075107610771078107910801081108210831084108510861087108810891090109110921093109410951096109710981099110011011102110311041105110611071108110911101111111211131114111511161117111811191120112111221123112411251126112711281129113011311132113311341135113611371138113911401141114211431144114511461147114811491150115111521153115411551156115711581159116011611162116311641165116611671168116911701171117211731174117511761177117811791180118111821183118411851186118711881189119011911192119311941195119611971198119912001201120212031204120512061207120812091210121112121213121412151216121712181219122012211222122312241225122612271228122912301231123212331234123512361237123812391240124112421243124412451246124712481249125012511252125312541255125612571258125912601261126212631264126512661267126812691270127112721273127412751276127712781279128012811282128312841285128612871288128912901291129212931294129512961297129812991300130113021303130413051306130713081309131013111312131313141315131613171318131913201321132213231324132513261327132813291330133113321333133413351336133713381339134013411342134313441345134613471348134913501351135213531354135513561357135813591360136113621363136413651366136713681369137013711372137313741375137613771378137913801381138213831384138513861387138813891390139113921393139413951396139713981399140014011402140314041405140614071408140914101411141214131414141514161417141814191420142114221423142414251426142714281429143014311432143314341435143614371438143914401441144214431444144514461447144814491450145114521453145414551456145714581459146014611462146314641465146614671468146914701471147214731474147514761477147814791480148114821483148414851486148714881489149014911492149314941495149614971498149915001501150215031504150515061507150815091510151115121513151415151516151715181519152015211522152315241525152615271528152915301531153215331534153515361537153815391540154115421543154415451546154715481549155015511552155315541555155615571558155915601561156215631564156515661567156815691570157115721573157415751576157715781579158015811582158315841585158615871588158915901591159215931594159515961597159815991600160116021603160416051606160716081609161016111612161316141615161616171618161916201621162216231624162516261627162816291630163116321633163416351636163716381639164016411642164316441645164616471648164916501651165216531654165516561657165816591660166116621663166416651666166716681669167016711672167316741675167616771678167916801681168216831684168516861687168816891690169116921693169416951696169716981699170017011702170317041705170617071708170917101711171217131714171517161717171817191720172117221723172417251726172717281729173017311732173317341735173617371738173917401741174217431744174517461747174817491750175117521753175417551756175717581759176017611762176317641765176617671768176917701771177217731774177517761777177817791780178117821783178417851786178717881789179017911792179317941795179617971798179918001801180218031804180518061807180818091810181118121813181418151816181718181819182018211822182318241825182618271828182918301831183218331834183518361837183818391840184118421843184418451846184718481849185018511852185318541855185618571858185918601861186218631864186518661867186818691870187118721873187418751876187718781879188018811882188318841885188618871888188918901891189218931894189518961897189818991900190119021903190419051906190719081909191019111912191319141915191619171918191919201921192219231924192519261927192819291930193119321933193419351936193719381939194019411942194319441945194619471948194919501951195219531954195519561957195819591960196119621963196419651966196719681969197019711972197319741975197619771978197919801981198219831984198519861987198819891990199119921993199419951996199719981999200020012002200320042005200620072008200920102011201220132014201520162017201820192020202120222023202420252026202720282029203020312032203320342035203620372038203920402041204220432044204520462047204820492050205120522053205420552056205720582059206020612062206320642065206620672068206920702071207220732074207520762077207820792080208120822083208420852086208720882089209020912092209320942095209620972098209921002101210221032104210521062107210821092110211121122113211421152116211721182119
## Done.</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb203-1"><a href="cm1-and-cm2.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding diploid and low-quality cells and excluding it from the copykit object</span></span>
<span id="cb203-2"><a href="cm1-and-cm2.html#cb203-2" aria-hidden="true" tabindex="-1"></a>cm1_tumor_primary <span class="ot">&lt;-</span> <span class="fu">findOutliers</span>(cm1_tumor_primary)</span></code></pre></div>
<pre><code>## Calculating correlation matrix.
## iteration: 123
## Marked 347 cells as outliers.
## Adding information to metadata. Access with colData(scCNA).
## Done.</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb205-1"><a href="cm1-and-cm2.html#cb205-1" aria-hidden="true" tabindex="-1"></a>cm1_tumor_primary <span class="ot">&lt;-</span> <span class="fu">findAneuploidCells</span>(cm1_tumor_primary)</span></code></pre></div>
<pre><code>## number of iterations= 10</code></pre>
<pre><code>## Copykit detected 35 that are possibly diploid cells using a resolution of: 0.048
## Added information to colData(CopyKit).</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb208-1"><a href="cm1-and-cm2.html#cb208-1" aria-hidden="true" tabindex="-1"></a>cm1_tumor_primary <span class="ot">&lt;-</span> cm1_tumor_primary[,<span class="fu">colData</span>(cm1_tumor_primary)<span class="sc">$</span>outlier <span class="sc">==</span> <span class="cn">FALSE</span>]</span>
<span id="cb208-2"><a href="cm1-and-cm2.html#cb208-2" aria-hidden="true" tabindex="-1"></a>cm1_tumor_primary <span class="ot">&lt;-</span> cm1_tumor_primary[,<span class="fu">colData</span>(cm1_tumor_primary)<span class="sc">$</span>is_aneuploid <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb208-3"><a href="cm1-and-cm2.html#cb208-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-4"><a href="cm1-and-cm2.html#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the tissue information to colData</span></span>
<span id="cb208-5"><a href="cm1-and-cm2.html#cb208-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(cm1_tumor_primary)<span class="sc">$</span>timepoint <span class="ot">&lt;-</span> <span class="st">&#39;primary&#39;</span></span></code></pre></div>
</div>
<div id="cm1-liver" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> CM1 liver</h2>
<div class="sourceCode" id="cb209"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb209-1"><a href="cm1-and-cm2.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Running data with CopyKit for the liver sample</span></span>
<span id="cb209-2"><a href="cm1-and-cm2.html#cb209-2" aria-hidden="true" tabindex="-1"></a>cm1_tumor_met <span class="ot">&lt;-</span></span>
<span id="cb209-3"><a href="cm1-and-cm2.html#cb209-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">runVarbin</span>(</span>
<span id="cb209-4"><a href="cm1-and-cm2.html#cb209-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;/mnt/lab/users/dminussi/projects/CopyKit_Manuscript_Code/datasets/CM1/liver/marked_bams&quot;</span>,</span>
<span id="cb209-5"><a href="cm1-and-cm2.html#cb209-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove_Y =</span> <span class="cn">TRUE</span></span>
<span id="cb209-6"><a href="cm1-and-cm2.html#cb209-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Counting reads for genome hg38 and resolution: 220kb</code></pre>
<pre><code>## 549 bam files had less than 10 mean bincounts and were removed.</code></pre>
<pre><code>## Performing GC correction.</code></pre>
<pre><code>## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928929930931932933934935936937938939940941942943944945946947948949950951952953954955956957958959960961962963964965966967968969970971972973974975976977978979980981982983984985986987988989990991992993994995996997998999100010011002100310041005100610071008100910101011101210131014101510161017101810191020102110221023102410251026102710281029103010311032103310341035103610371038103910401041104210431044104510461047104810491050105110521053105410551056105710581059106010611062106310641065106610671068106910701071107210731074107510761077107810791080108110821083108410851086108710881089109010911092109310941095109610971098109911001101110211031104110511061107110811091110111111121113111411151116111711181119112011211122112311241125112611271128112911301131113211331134113511361137113811391140114111421143114411451146114711481149115011511152115311541155115611571158115911601161116211631164116511661167116811691170117111721173117411751176117711781179118011811182118311841185118611871188118911901191119211931194119511961197119811991200120112021203120412051206120712081209121012111212121312141215121612171218121912201221122212231224122512261227122812291230123112321233123412351236123712381239124012411242124312441245124612471248124912501251125212531254125512561257125812591260126112621263126412651266126712681269127012711272127312741275127612771278127912801281128212831284128512861287128812891290129112921293129412951296129712981299130013011302130313041305130613071308130913101311131213131314131513161317131813191320132113221323132413251326132713281329133013311332133313341335133613371338133913401341134213431344134513461347134813491350135113521353135413551356135713581359136013611362136313641365136613671368136913701371137213731374137513761377137813791380138113821383138413851386138713881389139013911392139313941395139613971398139914001401140214031404140514061407140814091410141114121413141414151416141714181419142014211422142314241425142614271428142914301431143214331434143514361437143814391440144114421443144414451446144714481449145014511452145314541455145614571458145914601461146214631464146514661467146814691470147114721473147414751476147714781479148014811482148314841485148614871488148914901491149214931494149514961497149814991500150115021503150415051506150715081509151015111512151315141515151615171518151915201521152215231524152515261527152815291530153115321533153415351536153715381539154015411542154315441545154615471548154915501551155215531554155515561557155815591560156115621563156415651566156715681569157015711572157315741575157615771578157915801581158215831584158515861587158815891590159115921593159415951596159715981599160016011602160316041605160616071608160916101611161216131614161516161617161816191620162116221623162416251626162716281629163016311632163316341635163616371638163916401641164216431644164516461647164816491650165116521653165416551656165716581659
## Smoothing bin counts.
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928929930931932933934935936937938939940941942943944945946947948949950951952953954955956957958959960961962963964965966967968969970971972973974975976977978979980981982983984985986987988989990991992993994995996997998999100010011002100310041005100610071008100910101011101210131014101510161017101810191020102110221023102410251026102710281029103010311032103310341035103610371038103910401041104210431044104510461047104810491050105110521053105410551056105710581059106010611062106310641065106610671068106910701071107210731074107510761077107810791080108110821083108410851086108710881089109010911092109310941095109610971098109911001101110211031104110511061107110811091110111111121113111411151116111711181119112011211122112311241125112611271128112911301131113211331134113511361137113811391140114111421143114411451146114711481149115011511152115311541155115611571158115911601161116211631164116511661167116811691170117111721173117411751176117711781179118011811182118311841185118611871188118911901191119211931194119511961197119811991200120112021203120412051206120712081209121012111212121312141215121612171218121912201221122212231224122512261227122812291230123112321233123412351236123712381239124012411242124312441245124612471248124912501251125212531254125512561257125812591260126112621263126412651266126712681269127012711272127312741275127612771278127912801281128212831284128512861287128812891290129112921293129412951296129712981299130013011302130313041305130613071308130913101311131213131314131513161317131813191320132113221323132413251326132713281329133013311332133313341335133613371338133913401341134213431344134513461347134813491350135113521353135413551356135713581359136013611362136313641365136613671368136913701371137213731374137513761377137813791380138113821383138413851386138713881389139013911392139313941395139613971398139914001401140214031404140514061407140814091410141114121413141414151416141714181419142014211422142314241425142614271428142914301431143214331434143514361437143814391440144114421443144414451446144714481449145014511452145314541455145614571458145914601461146214631464146514661467146814691470147114721473147414751476147714781479148014811482148314841485148614871488148914901491149214931494149514961497149814991500150115021503150415051506150715081509151015111512151315141515151615171518151915201521152215231524152515261527152815291530153115321533153415351536153715381539154015411542154315441545154615471548154915501551155215531554155515561557155815591560156115621563156415651566156715681569157015711572157315741575157615771578157915801581158215831584158515861587158815891590159115921593159415951596159715981599160016011602160316041605160616071608160916101611161216131614161516161617161816191620162116221623162416251626162716281629163016311632163316341635163616371638163916401641164216431644164516461647164816491650165116521653165416551656165716581659
## Running segmentation algorithm: CBS for genome hg38
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928929930931932933934935936937938939940941942943944945946947948949950951952953954955956957958959960961962963964965966967968969970971972973974975976977978979980981982983984985986987988989990991992993994995996997998999100010011002100310041005100610071008100910101011101210131014101510161017101810191020102110221023102410251026102710281029103010311032103310341035103610371038103910401041104210431044104510461047104810491050105110521053105410551056105710581059106010611062106310641065106610671068106910701071107210731074107510761077107810791080108110821083108410851086108710881089109010911092109310941095109610971098109911001101110211031104110511061107110811091110111111121113111411151116111711181119112011211122112311241125112611271128112911301131113211331134113511361137113811391140114111421143114411451146114711481149115011511152115311541155115611571158115911601161116211631164116511661167116811691170117111721173117411751176117711781179118011811182118311841185118611871188118911901191119211931194119511961197119811991200120112021203120412051206120712081209121012111212121312141215121612171218121912201221122212231224122512261227122812291230123112321233123412351236123712381239124012411242124312441245124612471248124912501251125212531254125512561257125812591260126112621263126412651266126712681269127012711272127312741275127612771278127912801281128212831284128512861287128812891290129112921293129412951296129712981299130013011302130313041305130613071308130913101311131213131314131513161317131813191320132113221323132413251326132713281329133013311332133313341335133613371338133913401341134213431344134513461347134813491350135113521353135413551356135713581359136013611362136313641365136613671368136913701371137213731374137513761377137813791380138113821383138413851386138713881389139013911392139313941395139613971398139914001401140214031404140514061407140814091410141114121413141414151416141714181419142014211422142314241425142614271428142914301431143214331434143514361437143814391440144114421443144414451446144714481449145014511452145314541455145614571458145914601461146214631464146514661467146814691470147114721473147414751476147714781479148014811482148314841485148614871488148914901491149214931494149514961497149814991500150115021503150415051506150715081509151015111512151315141515151615171518151915201521152215231524152515261527152815291530153115321533153415351536153715381539154015411542154315441545154615471548154915501551155215531554155515561557155815591560156115621563156415651566156715681569157015711572157315741575157615771578157915801581158215831584158515861587158815891590159115921593159415951596159715981599160016011602160316041605160616071608160916101611161216131614161516161617161816191620162116221623162416251626162716281629163016311632163316341635163616371638163916401641164216431644164516461647164816491650165116521653165416551656165716581659
## Merging levels.
## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928929930931932933934935936937938939940941942943944945946947948949950951952953954955956957958959960961962963964965966967968969970971972973974975976977978979980981982983984985986987988989990991992993994995996997998999100010011002100310041005100610071008100910101011101210131014101510161017101810191020102110221023102410251026102710281029103010311032103310341035103610371038103910401041104210431044104510461047104810491050105110521053105410551056105710581059106010611062106310641065106610671068106910701071107210731074107510761077107810791080108110821083108410851086108710881089109010911092109310941095109610971098109911001101110211031104110511061107110811091110111111121113111411151116111711181119112011211122112311241125112611271128112911301131113211331134113511361137113811391140114111421143114411451146114711481149115011511152115311541155115611571158115911601161116211631164116511661167116811691170117111721173117411751176117711781179118011811182118311841185118611871188118911901191119211931194119511961197119811991200120112021203120412051206120712081209121012111212121312141215121612171218121912201221122212231224122512261227122812291230123112321233123412351236123712381239124012411242124312441245124612471248124912501251125212531254125512561257125812591260126112621263126412651266126712681269127012711272127312741275127612771278127912801281128212831284128512861287128812891290129112921293129412951296129712981299130013011302130313041305130613071308130913101311131213131314131513161317131813191320132113221323132413251326132713281329133013311332133313341335133613371338133913401341134213431344134513461347134813491350135113521353135413551356135713581359136013611362136313641365136613671368136913701371137213731374137513761377137813791380138113821383138413851386138713881389139013911392139313941395139613971398139914001401140214031404140514061407140814091410141114121413141414151416141714181419142014211422142314241425142614271428142914301431143214331434143514361437143814391440144114421443144414451446144714481449145014511452145314541455145614571458145914601461146214631464146514661467146814691470147114721473147414751476147714781479148014811482148314841485148614871488148914901491149214931494149514961497149814991500150115021503150415051506150715081509151015111512151315141515151615171518151915201521152215231524152515261527152815291530153115321533153415351536153715381539154015411542154315441545154615471548154915501551155215531554155515561557155815591560156115621563156415651566156715681569157015711572157315741575157615771578157915801581158215831584158515861587158815891590159115921593159415951596159715981599160016011602160316041605160616071608160916101611161216131614161516161617161816191620162116221623162416251626162716281629163016311632163316341635163616371638163916401641164216431644164516461647164816491650165116521653165416551656165716581659
## Done.</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb214-1"><a href="cm1-and-cm2.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding diploid and low-quality cells and excluding it from the copykit object</span></span>
<span id="cb214-2"><a href="cm1-and-cm2.html#cb214-2" aria-hidden="true" tabindex="-1"></a>cm1_tumor_met <span class="ot">&lt;-</span> <span class="fu">findOutliers</span>(cm1_tumor_met)</span></code></pre></div>
<pre><code>## Calculating correlation matrix.
## Marked 85 cells as outliers.
## Adding information to metadata. Access with colData(scCNA).
## Done.</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb216-1"><a href="cm1-and-cm2.html#cb216-1" aria-hidden="true" tabindex="-1"></a>cm1_tumor_met <span class="ot">&lt;-</span> <span class="fu">findAneuploidCells</span>(cm1_tumor_met)</span></code></pre></div>
<pre><code>## number of iterations= 8</code></pre>
<pre><code>## Copykit detected 13 that are possibly diploid cells using a resolution of: 0.053
## Added information to colData(CopyKit).</code></pre>
<div class="sourceCode" id="cb219"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb219-1"><a href="cm1-and-cm2.html#cb219-1" aria-hidden="true" tabindex="-1"></a>cm1_tumor_met <span class="ot">&lt;-</span></span>
<span id="cb219-2"><a href="cm1-and-cm2.html#cb219-2" aria-hidden="true" tabindex="-1"></a>  cm1_tumor_met[, <span class="fu">colData</span>(cm1_tumor_met)<span class="sc">$</span>outlier <span class="sc">==</span> <span class="cn">FALSE</span>]</span>
<span id="cb219-3"><a href="cm1-and-cm2.html#cb219-3" aria-hidden="true" tabindex="-1"></a>cm1_tumor_met <span class="ot">&lt;-</span></span>
<span id="cb219-4"><a href="cm1-and-cm2.html#cb219-4" aria-hidden="true" tabindex="-1"></a>  cm1_tumor_met[, <span class="fu">colData</span>(cm1_tumor_met)<span class="sc">$</span>is_aneuploid <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb219-5"><a href="cm1-and-cm2.html#cb219-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-6"><a href="cm1-and-cm2.html#cb219-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the tissue information to colData</span></span>
<span id="cb219-7"><a href="cm1-and-cm2.html#cb219-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(cm1_tumor_met)<span class="sc">$</span>timepoint <span class="ot">&lt;-</span> <span class="st">&#39;metastasis&#39;</span></span></code></pre></div>
</div>
<div id="cm1-merging" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> CM1 merging</h2>
<div class="sourceCode" id="cb220"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb220-1"><a href="cm1-and-cm2.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging the three copykit objects</span></span>
<span id="cb220-2"><a href="cm1-and-cm2.html#cb220-2" aria-hidden="true" tabindex="-1"></a>cm1_merged <span class="ot">&lt;-</span> <span class="fu">cbind</span>(cm1_tumor_primary,</span>
<span id="cb220-3"><a href="cm1-and-cm2.html#cb220-3" aria-hidden="true" tabindex="-1"></a>                    cm1_tumor_met)</span>
<span id="cb220-4"><a href="cm1-and-cm2.html#cb220-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-5"><a href="cm1-and-cm2.html#cb220-5" aria-hidden="true" tabindex="-1"></a>cm1_merged <span class="ot">&lt;-</span> <span class="fu">runUmap</span>(cm1_merged)</span></code></pre></div>
<pre><code>## Using assay: logr</code></pre>
<pre><code>## Embedding data with UMAP. Using seed 17</code></pre>
<pre><code>## Access reduced dimensions slot with: reducedDim(scCNA, &#39;umap&#39;).</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb225"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb225-1"><a href="cm1-and-cm2.html#cb225-1" aria-hidden="true" tabindex="-1"></a>cm1_merged <span class="ot">&lt;-</span> <span class="fu">findSuggestedK</span>(cm1_merged)</span></code></pre></div>
<pre><code>## Calculating jaccard similarity for k range: 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57</code></pre>
<pre><code>## </code></pre>
<pre><code>## iteration: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748
## Suggested k = 44 with median jaccard similarity of: 0.97</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb229-1"><a href="cm1-and-cm2.html#cb229-1" aria-hidden="true" tabindex="-1"></a>cm1_merged_suggestedk <span class="ot">&lt;-</span> <span class="fu">plotSuggestedK</span>(cm1_merged)</span>
<span id="cb229-2"><a href="cm1-and-cm2.html#cb229-2" aria-hidden="true" tabindex="-1"></a>cm1_merged_suggestedk</span></code></pre></div>
<p><img src="_main_files/figure-html/cm1_merge-1.png" width="672" /></p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb230-1"><a href="cm1-and-cm2.html#cb230-1" aria-hidden="true" tabindex="-1"></a>cm1_merged <span class="ot">&lt;-</span> <span class="fu">findClusters</span>(cm1_merged)</span></code></pre></div>
<pre><code>## Using suggested k_subclones = 44
## Finding clusters, using method: hdbscan
## Found 226 outliers cells (group &#39;c0&#39;)
## Found 22 subclones.
## Done.</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb232-1"><a href="cm1-and-cm2.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HDBSCAN is an outlier aware clustering algorithm</span></span>
<span id="cb232-2"><a href="cm1-and-cm2.html#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in this analysis all cells marked as outliers (c0) from hdbscan are excluded.</span></span>
<span id="cb232-3"><a href="cm1-and-cm2.html#cb232-3" aria-hidden="true" tabindex="-1"></a>cm1_merged <span class="ot">&lt;-</span> cm1_merged[, <span class="fu">colData</span>(cm1_merged)<span class="sc">$</span>subclones <span class="sc">!=</span> <span class="st">&#39;c0&#39;</span>]</span>
<span id="cb232-4"><a href="cm1-and-cm2.html#cb232-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-5"><a href="cm1-and-cm2.html#cb232-5" aria-hidden="true" tabindex="-1"></a>cm1_merged_tp_umap_p <span class="ot">&lt;-</span> <span class="fu">plotUmap</span>(cm1_merged, <span class="at">label =</span> <span class="st">&#39;timepoint&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.
## Coloring by: timepoint.</code></pre>
<div class="sourceCode" id="cb234"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb234-1"><a href="cm1-and-cm2.html#cb234-1" aria-hidden="true" tabindex="-1"></a>cm1_merged_tp_umap_p</span></code></pre></div>
<p><img src="_main_files/figure-html/cm1_merge-2.png" width="672" /></p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb235-1"><a href="cm1-and-cm2.html#cb235-1" aria-hidden="true" tabindex="-1"></a>cm1_merged_umap_p <span class="ot">&lt;-</span> <span class="fu">plotUmap</span>(cm1_merged, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.
## Coloring by: subclones.</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb237-1"><a href="cm1-and-cm2.html#cb237-1" aria-hidden="true" tabindex="-1"></a>cm1_merged_umap_p</span></code></pre></div>
<p><img src="_main_files/figure-html/cm1_merge-3.png" width="672" /></p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb238-1"><a href="cm1-and-cm2.html#cb238-1" aria-hidden="true" tabindex="-1"></a>cm1_merged <span class="ot">&lt;-</span> <span class="fu">calcConsensus</span>(cm1_merged)</span></code></pre></div>
<pre><code>## iteration: 12345678910111213141516171819202122</code></pre>
<div class="sourceCode" id="cb240"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb240-1"><a href="cm1-and-cm2.html#cb240-1" aria-hidden="true" tabindex="-1"></a>cm1_merged <span class="ot">&lt;-</span> <span class="fu">runConsensusPhylo</span>(cm1_merged)</span>
<span id="cb240-2"><a href="cm1-and-cm2.html#cb240-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-3"><a href="cm1-and-cm2.html#cb240-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(cm1_merged)<span class="sc">$</span>timepoint <span class="ot">&lt;-</span></span>
<span id="cb240-4"><a href="cm1-and-cm2.html#cb240-4" aria-hidden="true" tabindex="-1"></a>  forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(<span class="fu">colData</span>(cm1_merged)<span class="sc">$</span>timepoint,</span>
<span id="cb240-5"><a href="cm1-and-cm2.html#cb240-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">&quot;primary&quot;</span>, <span class="st">&quot;metastasis&quot;</span>))</span>
<span id="cb240-6"><a href="cm1-and-cm2.html#cb240-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-7"><a href="cm1-and-cm2.html#cb240-7" aria-hidden="true" tabindex="-1"></a>cm1_selected_genes <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb240-8"><a href="cm1-and-cm2.html#cb240-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;SMAD3&quot;</span>,</span>
<span id="cb240-9"><a href="cm1-and-cm2.html#cb240-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;FHIT&quot;</span>,</span>
<span id="cb240-10"><a href="cm1-and-cm2.html#cb240-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;APC&quot;</span>,</span>
<span id="cb240-11"><a href="cm1-and-cm2.html#cb240-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;SOX4&quot;</span>,</span>
<span id="cb240-12"><a href="cm1-and-cm2.html#cb240-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;IGFBP7&quot;</span>,</span>
<span id="cb240-13"><a href="cm1-and-cm2.html#cb240-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;CDK8&quot;</span>,</span>
<span id="cb240-14"><a href="cm1-and-cm2.html#cb240-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;PIK3CA&quot;</span>,</span>
<span id="cb240-15"><a href="cm1-and-cm2.html#cb240-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;MYC&quot;</span>,</span>
<span id="cb240-16"><a href="cm1-and-cm2.html#cb240-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;TP53&#39;</span>,</span>
<span id="cb240-17"><a href="cm1-and-cm2.html#cb240-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;GATA4&quot;</span>,</span>
<span id="cb240-18"><a href="cm1-and-cm2.html#cb240-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;CHEK1&quot;</span>,</span>
<span id="cb240-19"><a href="cm1-and-cm2.html#cb240-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;TGFB1&quot;</span>,</span>
<span id="cb240-20"><a href="cm1-and-cm2.html#cb240-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;TIAM1&quot;</span></span>
<span id="cb240-21"><a href="cm1-and-cm2.html#cb240-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb240-22"><a href="cm1-and-cm2.html#cb240-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-23"><a href="cm1-and-cm2.html#cb240-23" aria-hidden="true" tabindex="-1"></a>cm1_merged_selected_hvg_gc <span class="ot">&lt;-</span></span>
<span id="cb240-24"><a href="cm1-and-cm2.html#cb240-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plotGeneCopy</span>(cm1_merged,</span>
<span id="cb240-25"><a href="cm1-and-cm2.html#cb240-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">genes =</span> cm1_selected_genes,</span>
<span id="cb240-26"><a href="cm1-and-cm2.html#cb240-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">label =</span> <span class="st">&#39;timepoint&#39;</span>,</span>
<span id="cb240-27"><a href="cm1-and-cm2.html#cb240-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">dodge.width =</span> .<span class="dv">8</span>) <span class="sc">+</span> <span class="fu">scale_fill_hue</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Coloring by: timepoint
## Scale for &#39;fill&#39; is already present. Adding another scale for &#39;fill&#39;, which will replace the existing
## scale.</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb242-1"><a href="cm1-and-cm2.html#cb242-1" aria-hidden="true" tabindex="-1"></a>cm1_merged_selected_hvg_gc</span></code></pre></div>
<p><img src="_main_files/figure-html/cm1_merge-4.png" width="672" /></p>
<p>To root the tree, we will use an inferred Most Recent Common Ancestral from the primary tumor and provide that as an argument to the runConsensusPhylo function.
This consensus tree will be used by plotHeatmap to order the subclones on the plot</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb243-1"><a href="cm1-and-cm2.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clustering and inferring the MRCA from the clusters</span></span>
<span id="cb243-2"><a href="cm1-and-cm2.html#cb243-2" aria-hidden="true" tabindex="-1"></a>cm1_tumor_primary <span class="ot">&lt;-</span> <span class="fu">runUmap</span>(cm1_tumor_primary)</span></code></pre></div>
<pre><code>## Using assay: logr</code></pre>
<pre><code>## Embedding data with UMAP. Using seed 17</code></pre>
<pre><code>## Access reduced dimensions slot with: reducedDim(scCNA, &#39;umap&#39;).</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb248-1"><a href="cm1-and-cm2.html#cb248-1" aria-hidden="true" tabindex="-1"></a>cm1_tumor_primary <span class="ot">&lt;-</span> <span class="fu">findSuggestedK</span>(cm1_tumor_primary)</span></code></pre></div>
<pre><code>## Calculating jaccard similarity for k range: 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42</code></pre>
<pre><code>## </code></pre>
<pre><code>## iteration: 123456789101112131415161718192021222324252627282930313233
## Suggested k = 37 with median jaccard similarity of: 1</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb252-1"><a href="cm1-and-cm2.html#cb252-1" aria-hidden="true" tabindex="-1"></a>cm1_tumor_primary <span class="ot">&lt;-</span> <span class="fu">findClusters</span>(cm1_tumor_primary)</span></code></pre></div>
<pre><code>## Using suggested k_subclones = 37
## Finding clusters, using method: hdbscan
## Found 54 outliers cells (group &#39;c0&#39;)
## Found 10 subclones.
## Done.</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb254-1"><a href="cm1-and-cm2.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HDBSCAN is an outlier aware clustering algorithm</span></span>
<span id="cb254-2"><a href="cm1-and-cm2.html#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in this analysis all cells marked as outliers (c0) from hdbscan are excluded.</span></span>
<span id="cb254-3"><a href="cm1-and-cm2.html#cb254-3" aria-hidden="true" tabindex="-1"></a>cm1_tumor_primary <span class="ot">&lt;-</span></span>
<span id="cb254-4"><a href="cm1-and-cm2.html#cb254-4" aria-hidden="true" tabindex="-1"></a>  cm1_tumor_primary[, <span class="fu">colData</span>(cm1_tumor_primary)<span class="sc">$</span>subclones <span class="sc">!=</span> <span class="st">&#39;c0&#39;</span>]</span>
<span id="cb254-5"><a href="cm1-and-cm2.html#cb254-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-6"><a href="cm1-and-cm2.html#cb254-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-7"><a href="cm1-and-cm2.html#cb254-7" aria-hidden="true" tabindex="-1"></a><span class="co"># calculating the consensus of the Merged dataset and using the inferred</span></span>
<span id="cb254-8"><a href="cm1-and-cm2.html#cb254-8" aria-hidden="true" tabindex="-1"></a><span class="co"># primary MRCA as the root of the tree</span></span>
<span id="cb254-9"><a href="cm1-and-cm2.html#cb254-9" aria-hidden="true" tabindex="-1"></a>cm1_tumor_primary <span class="ot">&lt;-</span> <span class="fu">calcConsensus</span>(cm1_tumor_primary)</span></code></pre></div>
<pre><code>## iteration: 12345678910</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb256-1"><a href="cm1-and-cm2.html#cb256-1" aria-hidden="true" tabindex="-1"></a>cm1_tumor_primary <span class="ot">&lt;-</span> <span class="fu">inferMrca</span>(cm1_tumor_primary)</span>
<span id="cb256-2"><a href="cm1-and-cm2.html#cb256-2" aria-hidden="true" tabindex="-1"></a>cm1_merged <span class="ot">&lt;-</span> <span class="fu">runConsensusPhylo</span>(</span>
<span id="cb256-3"><a href="cm1-and-cm2.html#cb256-3" aria-hidden="true" tabindex="-1"></a>  cm1_merged,</span>
<span id="cb256-4"><a href="cm1-and-cm2.html#cb256-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">root =</span> <span class="st">&#39;user&#39;</span>,</span>
<span id="cb256-5"><a href="cm1-and-cm2.html#cb256-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">root_user =</span> <span class="fu">metadata</span>(cm1_tumor_primary)<span class="sc">$</span>inferred_mrca</span>
<span id="cb256-6"><a href="cm1-and-cm2.html#cb256-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb256-7"><a href="cm1-and-cm2.html#cb256-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-8"><a href="cm1-and-cm2.html#cb256-8" aria-hidden="true" tabindex="-1"></a><span class="co"># relevel factors to plot in the desired order</span></span>
<span id="cb256-9"><a href="cm1-and-cm2.html#cb256-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(cm1_merged)<span class="sc">$</span>timepoint <span class="ot">&lt;-</span></span>
<span id="cb256-10"><a href="cm1-and-cm2.html#cb256-10" aria-hidden="true" tabindex="-1"></a>  forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(<span class="fu">colData</span>(cm1_merged)<span class="sc">$</span>timepoint,</span>
<span id="cb256-11"><a href="cm1-and-cm2.html#cb256-11" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">&quot;metastasis&quot;</span>, <span class="st">&quot;primary&quot;</span>))</span>
<span id="cb256-12"><a href="cm1-and-cm2.html#cb256-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-13"><a href="cm1-and-cm2.html#cb256-13" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting the phylogeny with subclones labels and pie charts</span></span>
<span id="cb256-14"><a href="cm1-and-cm2.html#cb256-14" aria-hidden="true" tabindex="-1"></a><span class="co">#indicating the frequency of each timepoint</span></span>
<span id="cb256-15"><a href="cm1-and-cm2.html#cb256-15" aria-hidden="true" tabindex="-1"></a>cm1_merged_consensus_phylo <span class="ot">&lt;-</span></span>
<span id="cb256-16"><a href="cm1-and-cm2.html#cb256-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plotPhylo</span>(cm1_merged,</span>
<span id="cb256-17"><a href="cm1-and-cm2.html#cb256-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>,</span>
<span id="cb256-18"><a href="cm1-and-cm2.html#cb256-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">consensus =</span> <span class="cn">TRUE</span>,</span>
<span id="cb256-19"><a href="cm1-and-cm2.html#cb256-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">group =</span> <span class="st">&#39;timepoint&#39;</span>)</span>
<span id="cb256-20"><a href="cm1-and-cm2.html#cb256-20" aria-hidden="true" tabindex="-1"></a>cm1_merged_consensus_phylo</span></code></pre></div>
<p><img src="_main_files/figure-html/cm1_tree-1.png" width="672" /></p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb257-1"><a href="cm1-and-cm2.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(cm1_merged, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&#39;subclones&#39;</span>, <span class="st">&#39;timepoint&#39;</span>))</span></code></pre></div>
<pre><code>## Plotting Heatmap.</code></pre>
<pre><code>## The automatically generated colors map from the minus and plus 99^th of the absolute values in
## the matrix. There are outliers in the matrix whose patterns might be hidden by this color
## mapping. You can manually set the color to `col` argument.
## 
## Use `suppressMessages()` to turn off this message.</code></pre>
<p><img src="_main_files/figure-html/cm1_heatmap-1.png" width="768" /></p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb260-1"><a href="cm1-and-cm2.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(</span>
<span id="cb260-2"><a href="cm1-and-cm2.html#cb260-2" aria-hidden="true" tabindex="-1"></a>  cm1_merged,</span>
<span id="cb260-3"><a href="cm1-and-cm2.html#cb260-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&#39;subclones&#39;</span>),</span>
<span id="cb260-4"><a href="cm1-and-cm2.html#cb260-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">consensus =</span> <span class="cn">TRUE</span>,</span>
<span id="cb260-5"><a href="cm1-and-cm2.html#cb260-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">genes =</span> cm1_selected_genes</span>
<span id="cb260-6"><a href="cm1-and-cm2.html#cb260-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="_main_files/figure-html/cm1_consensus_heatmap-1.png" width="672" /></p>
</div>
<div id="cm2" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> CM2</h2>
</div>
<div id="cm2-colon" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> CM2 colon</h2>
<div class="sourceCode" id="cb262"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb262-1"><a href="cm1-and-cm2.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Running data with CopyKit for the primary colon sample</span></span>
<span id="cb262-2"><a href="cm1-and-cm2.html#cb262-2" aria-hidden="true" tabindex="-1"></a>cm2_tumor_primary <span class="ot">&lt;-</span> <span class="fu">runVarbin</span>(<span class="st">&quot;/mnt/lab/users/dminussi/projects/CopyKit_Manuscript_Code/datasets/CM2/colon/marked_bams&quot;</span>, <span class="at">remove_Y =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Counting reads for genome hg38 and resolution: 220kb</code></pre>
<pre><code>## 89 bam files had less than 10 mean bincounts and were removed.</code></pre>
<pre><code>## Performing GC correction.</code></pre>
<pre><code>## iteration: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003100410051006100710081009101010111012101310141015101610171018101910201021102210231024102510261027102810291030103110321033103410351036103710381039104010411042104310441045104610471048104910501051105210531054105510561057105810591060106110621063
## Smoothing bin counts.
## iteration: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003100410051006100710081009101010111012101310141015101610171018101910201021102210231024102510261027102810291030103110321033103410351036103710381039104010411042104310441045104610471048104910501051105210531054105510561057105810591060106110621063
## Running segmentation algorithm: CBS for genome hg38
## iteration: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003100410051006100710081009101010111012101310141015101610171018101910201021102210231024102510261027102810291030103110321033103410351036103710381039104010411042104310441045104610471048104910501051105210531054105510561057105810591060106110621063
## Merging levels.
## iteration: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003100410051006100710081009101010111012101310141015101610171018101910201021102210231024102510261027102810291030103110321033103410351036103710381039104010411042104310441045104610471048104910501051105210531054105510561057105810591060106110621063
## Done.</code></pre>
<div class="sourceCode" id="cb267"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb267-1"><a href="cm1-and-cm2.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding diploid and low-quality cells and excluding it from the copykit object</span></span>
<span id="cb267-2"><a href="cm1-and-cm2.html#cb267-2" aria-hidden="true" tabindex="-1"></a>cm2_tumor_primary <span class="ot">&lt;-</span> <span class="fu">findOutliers</span>(cm2_tumor_primary)</span></code></pre></div>
<pre><code>## Calculating correlation matrix.
## Marked 119 cells as outliers.
## Adding information to metadata. Access with colData(scCNA).
## Done.</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb269-1"><a href="cm1-and-cm2.html#cb269-1" aria-hidden="true" tabindex="-1"></a>cm2_tumor_primary <span class="ot">&lt;-</span> <span class="fu">findAneuploidCells</span>(cm2_tumor_primary)</span></code></pre></div>
<pre><code>## number of iterations= 8</code></pre>
<pre><code>## Copykit detected 8 that are possibly diploid cells using a resolution of: 0.051
## Added information to colData(CopyKit).</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb272-1"><a href="cm1-and-cm2.html#cb272-1" aria-hidden="true" tabindex="-1"></a>cm2_tumor_primary <span class="ot">&lt;-</span> cm2_tumor_primary[,<span class="fu">colData</span>(cm2_tumor_primary)<span class="sc">$</span>outlier <span class="sc">==</span> <span class="cn">FALSE</span>]</span>
<span id="cb272-2"><a href="cm1-and-cm2.html#cb272-2" aria-hidden="true" tabindex="-1"></a>cm2_tumor_primary <span class="ot">&lt;-</span> cm2_tumor_primary[,<span class="fu">colData</span>(cm2_tumor_primary)<span class="sc">$</span>is_aneuploid <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb272-3"><a href="cm1-and-cm2.html#cb272-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-4"><a href="cm1-and-cm2.html#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the tissue information to colData</span></span>
<span id="cb272-5"><a href="cm1-and-cm2.html#cb272-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(cm2_tumor_primary)<span class="sc">$</span>timepoint <span class="ot">&lt;-</span> <span class="st">&#39;primary&#39;</span></span></code></pre></div>
</div>
<div id="cm2-liver" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> CM2 liver</h2>
<div class="sourceCode" id="cb273"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb273-1"><a href="cm1-and-cm2.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Running data with CopyKit for the liver sample</span></span>
<span id="cb273-2"><a href="cm1-and-cm2.html#cb273-2" aria-hidden="true" tabindex="-1"></a>cm2_tumor_met <span class="ot">&lt;-</span></span>
<span id="cb273-3"><a href="cm1-and-cm2.html#cb273-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">runVarbin</span>(</span>
<span id="cb273-4"><a href="cm1-and-cm2.html#cb273-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;/mnt/lab/users/dminussi/projects/CopyKit_Manuscript_Code/datasets/CM2/liver/marked_bams&quot;</span>,</span>
<span id="cb273-5"><a href="cm1-and-cm2.html#cb273-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove_Y =</span> <span class="cn">TRUE</span></span>
<span id="cb273-6"><a href="cm1-and-cm2.html#cb273-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Counting reads for genome hg38 and resolution: 220kb</code></pre>
<pre><code>## 149 bam files had less than 10 mean bincounts and were removed.</code></pre>
<pre><code>## Performing GC correction.</code></pre>
<pre><code>## iteration: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003
## Smoothing bin counts.
## iteration: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003
## Running segmentation algorithm: CBS for genome hg38
## iteration: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003
## Merging levels.
## iteration: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003
## Done.</code></pre>
<div class="sourceCode" id="cb278"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb278-1"><a href="cm1-and-cm2.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding diploid and low-quality cells and excluding it from the copykit object</span></span>
<span id="cb278-2"><a href="cm1-and-cm2.html#cb278-2" aria-hidden="true" tabindex="-1"></a>cm2_tumor_met <span class="ot">&lt;-</span> <span class="fu">findOutliers</span>(cm2_tumor_met)</span></code></pre></div>
<pre><code>## Calculating correlation matrix.
## Marked 239 cells as outliers.
## Adding information to metadata. Access with colData(scCNA).
## Done.</code></pre>
<div class="sourceCode" id="cb280"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb280-1"><a href="cm1-and-cm2.html#cb280-1" aria-hidden="true" tabindex="-1"></a>cm2_tumor_met <span class="ot">&lt;-</span> <span class="fu">findAneuploidCells</span>(cm2_tumor_met)</span></code></pre></div>
<pre><code>## number of iterations= 8</code></pre>
<pre><code>## Copykit detected 6 that are possibly diploid cells using a resolution of: 0.051
## Added information to colData(CopyKit).</code></pre>
<div class="sourceCode" id="cb283"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb283-1"><a href="cm1-and-cm2.html#cb283-1" aria-hidden="true" tabindex="-1"></a>cm2_tumor_met <span class="ot">&lt;-</span></span>
<span id="cb283-2"><a href="cm1-and-cm2.html#cb283-2" aria-hidden="true" tabindex="-1"></a>  cm2_tumor_met[, <span class="fu">colData</span>(cm2_tumor_met)<span class="sc">$</span>outlier <span class="sc">==</span> <span class="cn">FALSE</span>]</span>
<span id="cb283-3"><a href="cm1-and-cm2.html#cb283-3" aria-hidden="true" tabindex="-1"></a>cm2_tumor_met <span class="ot">&lt;-</span></span>
<span id="cb283-4"><a href="cm1-and-cm2.html#cb283-4" aria-hidden="true" tabindex="-1"></a>  cm2_tumor_met[, <span class="fu">colData</span>(cm2_tumor_met)<span class="sc">$</span>is_aneuploid <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb283-5"><a href="cm1-and-cm2.html#cb283-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-6"><a href="cm1-and-cm2.html#cb283-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the tissue information to colData</span></span>
<span id="cb283-7"><a href="cm1-and-cm2.html#cb283-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(cm2_tumor_met)<span class="sc">$</span>timepoint <span class="ot">&lt;-</span> <span class="st">&#39;metastasis&#39;</span></span></code></pre></div>
</div>
<div id="cm2-merging" class="section level2" number="4.8">
<h2><span class="header-section-number">4.8</span> CM2 merging</h2>
<div class="sourceCode" id="cb284"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb284-1"><a href="cm1-and-cm2.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging the three copykit objects</span></span>
<span id="cb284-2"><a href="cm1-and-cm2.html#cb284-2" aria-hidden="true" tabindex="-1"></a>cm2_merged <span class="ot">&lt;-</span> <span class="fu">cbind</span>(cm2_tumor_primary,</span>
<span id="cb284-3"><a href="cm1-and-cm2.html#cb284-3" aria-hidden="true" tabindex="-1"></a>                    cm2_tumor_met)</span>
<span id="cb284-4"><a href="cm1-and-cm2.html#cb284-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-5"><a href="cm1-and-cm2.html#cb284-5" aria-hidden="true" tabindex="-1"></a>cm2_merged <span class="ot">&lt;-</span> <span class="fu">runUmap</span>(cm2_merged)</span></code></pre></div>
<pre><code>## Using assay: logr</code></pre>
<pre><code>## Embedding data with UMAP. Using seed 17</code></pre>
<pre><code>## Access reduced dimensions slot with: reducedDim(scCNA, &#39;umap&#39;).</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb289"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb289-1"><a href="cm1-and-cm2.html#cb289-1" aria-hidden="true" tabindex="-1"></a>cm2_merged <span class="ot">&lt;-</span> <span class="fu">findSuggestedK</span>(cm2_merged)</span></code></pre></div>
<pre><code>## Calculating jaccard similarity for k range: 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41</code></pre>
<pre><code>## </code></pre>
<pre><code>## iteration: 1234567891011121314151617181920212223242526272829303132
## Suggested k = 38 with median jaccard similarity of: 0.922</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb293-1"><a href="cm1-and-cm2.html#cb293-1" aria-hidden="true" tabindex="-1"></a>cm2_merged_suggestedk <span class="ot">&lt;-</span> <span class="fu">plotSuggestedK</span>(cm2_merged)</span>
<span id="cb293-2"><a href="cm1-and-cm2.html#cb293-2" aria-hidden="true" tabindex="-1"></a>cm2_merged_suggestedk</span></code></pre></div>
<p><img src="_main_files/figure-html/cm2_merge-1.png" width="672" /></p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb294-1"><a href="cm1-and-cm2.html#cb294-1" aria-hidden="true" tabindex="-1"></a>cm2_merged <span class="ot">&lt;-</span> <span class="fu">findClusters</span>(cm2_merged)</span></code></pre></div>
<pre><code>## Using suggested k_subclones = 38
## Finding clusters, using method: hdbscan
## Found 70 outliers cells (group &#39;c0&#39;)
## Found 11 subclones.
## Done.</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb296-1"><a href="cm1-and-cm2.html#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HDBSCAN is an outlier aware clustering algorithm</span></span>
<span id="cb296-2"><a href="cm1-and-cm2.html#cb296-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in this analysis all cells marked as outliers (c0) from hdbscan are excluded.</span></span>
<span id="cb296-3"><a href="cm1-and-cm2.html#cb296-3" aria-hidden="true" tabindex="-1"></a>cm2_merged <span class="ot">&lt;-</span> cm2_merged[, <span class="fu">colData</span>(cm2_merged)<span class="sc">$</span>subclones <span class="sc">!=</span> <span class="st">&#39;c0&#39;</span>]</span>
<span id="cb296-4"><a href="cm1-and-cm2.html#cb296-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-5"><a href="cm1-and-cm2.html#cb296-5" aria-hidden="true" tabindex="-1"></a>cm2_merged_tp_umap_p <span class="ot">&lt;-</span> <span class="fu">plotUmap</span>(cm2_merged, <span class="at">label =</span> <span class="st">&#39;timepoint&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.
## Coloring by: timepoint.</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb298-1"><a href="cm1-and-cm2.html#cb298-1" aria-hidden="true" tabindex="-1"></a>cm2_merged_tp_umap_p</span></code></pre></div>
<p><img src="_main_files/figure-html/cm2_merge-2.png" width="672" /></p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb299-1"><a href="cm1-and-cm2.html#cb299-1" aria-hidden="true" tabindex="-1"></a>cm2_merged_umap_p <span class="ot">&lt;-</span> <span class="fu">plotUmap</span>(cm2_merged, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.
## Coloring by: subclones.</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb301-1"><a href="cm1-and-cm2.html#cb301-1" aria-hidden="true" tabindex="-1"></a>cm2_merged_umap_p</span></code></pre></div>
<p><img src="_main_files/figure-html/cm2_merge-3.png" width="672" /></p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb302-1"><a href="cm1-and-cm2.html#cb302-1" aria-hidden="true" tabindex="-1"></a>cm2_merged <span class="ot">&lt;-</span> <span class="fu">calcConsensus</span>(cm2_merged)</span></code></pre></div>
<pre><code>## iteration: 1234567891011</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb304-1"><a href="cm1-and-cm2.html#cb304-1" aria-hidden="true" tabindex="-1"></a>cm2_merged <span class="ot">&lt;-</span> <span class="fu">runConsensusPhylo</span>(cm2_merged)</span>
<span id="cb304-2"><a href="cm1-and-cm2.html#cb304-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-3"><a href="cm1-and-cm2.html#cb304-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(cm2_merged)<span class="sc">$</span>timepoint <span class="ot">&lt;-</span></span>
<span id="cb304-4"><a href="cm1-and-cm2.html#cb304-4" aria-hidden="true" tabindex="-1"></a>  forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(<span class="fu">colData</span>(cm2_merged)<span class="sc">$</span>timepoint,</span>
<span id="cb304-5"><a href="cm1-and-cm2.html#cb304-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">&quot;primary&quot;</span>, <span class="st">&quot;metastasis&quot;</span>))</span>
<span id="cb304-6"><a href="cm1-and-cm2.html#cb304-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-7"><a href="cm1-and-cm2.html#cb304-7" aria-hidden="true" tabindex="-1"></a>cm2_selected_genes <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb304-8"><a href="cm1-and-cm2.html#cb304-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;IGF1R&quot;</span>,</span>
<span id="cb304-9"><a href="cm1-and-cm2.html#cb304-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;SMAD6&quot;</span>,</span>
<span id="cb304-10"><a href="cm1-and-cm2.html#cb304-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;FGFR2&quot;</span>,</span>
<span id="cb304-11"><a href="cm1-and-cm2.html#cb304-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;STAT3&quot;</span>,</span>
<span id="cb304-12"><a href="cm1-and-cm2.html#cb304-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;SOX9&quot;</span>,</span>
<span id="cb304-13"><a href="cm1-and-cm2.html#cb304-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;KLF5&quot;</span>,</span>
<span id="cb304-14"><a href="cm1-and-cm2.html#cb304-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;FGF9&quot;</span>,</span>
<span id="cb304-15"><a href="cm1-and-cm2.html#cb304-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;MSH2&quot;</span>,</span>
<span id="cb304-16"><a href="cm1-and-cm2.html#cb304-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;APC&quot;</span>,</span>
<span id="cb304-17"><a href="cm1-and-cm2.html#cb304-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;TP53&quot;</span>,</span>
<span id="cb304-18"><a href="cm1-and-cm2.html#cb304-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;TNFRSF6B&quot;</span>,</span>
<span id="cb304-19"><a href="cm1-and-cm2.html#cb304-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;CHEK2&quot;</span>,</span>
<span id="cb304-20"><a href="cm1-and-cm2.html#cb304-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;MAP3K8&quot;</span></span>
<span id="cb304-21"><a href="cm1-and-cm2.html#cb304-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb304-22"><a href="cm1-and-cm2.html#cb304-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-23"><a href="cm1-and-cm2.html#cb304-23" aria-hidden="true" tabindex="-1"></a>cm2_merged_selected_hvg_gc <span class="ot">&lt;-</span></span>
<span id="cb304-24"><a href="cm1-and-cm2.html#cb304-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plotGeneCopy</span>(cm2_merged,</span>
<span id="cb304-25"><a href="cm1-and-cm2.html#cb304-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">genes =</span> cm2_selected_genes,</span>
<span id="cb304-26"><a href="cm1-and-cm2.html#cb304-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">label =</span> <span class="st">&#39;timepoint&#39;</span>,</span>
<span id="cb304-27"><a href="cm1-and-cm2.html#cb304-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">dodge.width =</span> .<span class="dv">8</span>) <span class="sc">+</span> <span class="fu">scale_fill_hue</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Coloring by: timepoint</code></pre>
<pre><code>## Warning in find_scaffold_genes(scCNA, genes = genes): Genes: TNFRSF6B are in excluded regions of the Varbin
## pipeline and can&#39;t be plotted.</code></pre>
<pre><code>## Scale for &#39;fill&#39; is already present. Adding another scale for &#39;fill&#39;, which will replace the existing
## scale.</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb308-1"><a href="cm1-and-cm2.html#cb308-1" aria-hidden="true" tabindex="-1"></a>cm2_merged_selected_hvg_gc</span></code></pre></div>
<p><img src="_main_files/figure-html/cm2_merge-4.png" width="672" /></p>
<p>To root the tree, we will use an inferred Most Recent Common Ancestral from the primary tumor and provide that as an argument to the runConsensusPhylo function.
This consensus tree will be used by plotHeatmap to order the subclones on the plot</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb309-1"><a href="cm1-and-cm2.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clustering and inferring the MRCA from the clusters</span></span>
<span id="cb309-2"><a href="cm1-and-cm2.html#cb309-2" aria-hidden="true" tabindex="-1"></a>cm2_tumor_primary <span class="ot">&lt;-</span> <span class="fu">runUmap</span>(cm2_tumor_primary)</span></code></pre></div>
<pre><code>## Using assay: logr</code></pre>
<pre><code>## Embedding data with UMAP. Using seed 17</code></pre>
<pre><code>## Access reduced dimensions slot with: reducedDim(scCNA, &#39;umap&#39;).</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb314-1"><a href="cm1-and-cm2.html#cb314-1" aria-hidden="true" tabindex="-1"></a>cm2_tumor_primary <span class="ot">&lt;-</span> <span class="fu">findSuggestedK</span>(cm2_tumor_primary)</span></code></pre></div>
<pre><code>## Calculating jaccard similarity for k range: 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31</code></pre>
<pre><code>## </code></pre>
<pre><code>## iteration: 12345678910111213141516171819202122
## Suggested k = 28 with median jaccard similarity of: 0.944</code></pre>
<div class="sourceCode" id="cb318"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb318-1"><a href="cm1-and-cm2.html#cb318-1" aria-hidden="true" tabindex="-1"></a>cm2_tumor_primary <span class="ot">&lt;-</span> <span class="fu">findClusters</span>(cm2_tumor_primary)</span></code></pre></div>
<pre><code>## Using suggested k_subclones = 28
## Finding clusters, using method: hdbscan
## Found 17 outliers cells (group &#39;c0&#39;)
## Found 8 subclones.
## Done.</code></pre>
<div class="sourceCode" id="cb320"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb320-1"><a href="cm1-and-cm2.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HDBSCAN is an outlier aware clustering algorithm</span></span>
<span id="cb320-2"><a href="cm1-and-cm2.html#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in this analysis all cells marked as outliers (c0) from hdbscan are excluded.</span></span>
<span id="cb320-3"><a href="cm1-and-cm2.html#cb320-3" aria-hidden="true" tabindex="-1"></a>cm2_tumor_primary <span class="ot">&lt;-</span></span>
<span id="cb320-4"><a href="cm1-and-cm2.html#cb320-4" aria-hidden="true" tabindex="-1"></a>  cm2_tumor_primary[, <span class="fu">colData</span>(cm2_tumor_primary)<span class="sc">$</span>subclones <span class="sc">!=</span> <span class="st">&#39;c0&#39;</span>]</span>
<span id="cb320-5"><a href="cm1-and-cm2.html#cb320-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-6"><a href="cm1-and-cm2.html#cb320-6" aria-hidden="true" tabindex="-1"></a><span class="co"># calculating the consensus of the Merged dataset and using the inferred</span></span>
<span id="cb320-7"><a href="cm1-and-cm2.html#cb320-7" aria-hidden="true" tabindex="-1"></a><span class="co"># primary MRCA as the root of the tree</span></span>
<span id="cb320-8"><a href="cm1-and-cm2.html#cb320-8" aria-hidden="true" tabindex="-1"></a>cm2_tumor_primary <span class="ot">&lt;-</span> <span class="fu">calcConsensus</span>(cm2_tumor_primary)</span></code></pre></div>
<pre><code>## iteration: 12345678</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb322-1"><a href="cm1-and-cm2.html#cb322-1" aria-hidden="true" tabindex="-1"></a>cm2_tumor_primary <span class="ot">&lt;-</span> <span class="fu">inferMrca</span>(cm2_tumor_primary, <span class="at">value =</span> <span class="fl">0.8</span>)</span>
<span id="cb322-2"><a href="cm1-and-cm2.html#cb322-2" aria-hidden="true" tabindex="-1"></a>cm2_merged <span class="ot">&lt;-</span> <span class="fu">runConsensusPhylo</span>(</span>
<span id="cb322-3"><a href="cm1-and-cm2.html#cb322-3" aria-hidden="true" tabindex="-1"></a>  cm2_merged,</span>
<span id="cb322-4"><a href="cm1-and-cm2.html#cb322-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">root =</span> <span class="st">&#39;user&#39;</span>,</span>
<span id="cb322-5"><a href="cm1-and-cm2.html#cb322-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">root_user =</span> <span class="fu">metadata</span>(cm2_tumor_primary)<span class="sc">$</span>inferred_mrca</span>
<span id="cb322-6"><a href="cm1-and-cm2.html#cb322-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb322-7"><a href="cm1-and-cm2.html#cb322-7" aria-hidden="true" tabindex="-1"></a><span class="fu">consensusPhylo</span>(cm2_merged) <span class="ot">&lt;-</span> phytools<span class="sc">::</span><span class="fu">rotateNodes</span>(<span class="fu">consensusPhylo</span>(cm2_merged), <span class="fu">c</span>(<span class="dv">14</span>))</span>
<span id="cb322-8"><a href="cm1-and-cm2.html#cb322-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-9"><a href="cm1-and-cm2.html#cb322-9" aria-hidden="true" tabindex="-1"></a><span class="co"># relevel factors to plot in the desired order</span></span>
<span id="cb322-10"><a href="cm1-and-cm2.html#cb322-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(cm2_merged)<span class="sc">$</span>timepoint <span class="ot">&lt;-</span></span>
<span id="cb322-11"><a href="cm1-and-cm2.html#cb322-11" aria-hidden="true" tabindex="-1"></a>  forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(<span class="fu">colData</span>(cm2_merged)<span class="sc">$</span>timepoint,</span>
<span id="cb322-12"><a href="cm1-and-cm2.html#cb322-12" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">&quot;metastasis&quot;</span>, <span class="st">&quot;primary&quot;</span>))</span>
<span id="cb322-13"><a href="cm1-and-cm2.html#cb322-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-14"><a href="cm1-and-cm2.html#cb322-14" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting the phylogeny with subclones labels and pie charts</span></span>
<span id="cb322-15"><a href="cm1-and-cm2.html#cb322-15" aria-hidden="true" tabindex="-1"></a><span class="co">#indicating the frequency of each timepoint</span></span>
<span id="cb322-16"><a href="cm1-and-cm2.html#cb322-16" aria-hidden="true" tabindex="-1"></a>cm2_merged_consensus_phylo <span class="ot">&lt;-</span></span>
<span id="cb322-17"><a href="cm1-and-cm2.html#cb322-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plotPhylo</span>(cm2_merged,</span>
<span id="cb322-18"><a href="cm1-and-cm2.html#cb322-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>,</span>
<span id="cb322-19"><a href="cm1-and-cm2.html#cb322-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">consensus =</span> <span class="cn">TRUE</span>,</span>
<span id="cb322-20"><a href="cm1-and-cm2.html#cb322-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">group =</span> <span class="st">&#39;timepoint&#39;</span>)</span>
<span id="cb322-21"><a href="cm1-and-cm2.html#cb322-21" aria-hidden="true" tabindex="-1"></a>cm2_merged_consensus_phylo</span></code></pre></div>
<p><img src="_main_files/figure-html/cm2_tree-1.png" width="672" /></p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb323-1"><a href="cm1-and-cm2.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(cm2_merged, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&#39;subclones&#39;</span>, <span class="st">&#39;timepoint&#39;</span>))</span></code></pre></div>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="_main_files/figure-html/cm2_heatmap-1.png" width="768" /></p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb325-1"><a href="cm1-and-cm2.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(</span>
<span id="cb325-2"><a href="cm1-and-cm2.html#cb325-2" aria-hidden="true" tabindex="-1"></a>  cm2_merged,</span>
<span id="cb325-3"><a href="cm1-and-cm2.html#cb325-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&#39;subclones&#39;</span>),</span>
<span id="cb325-4"><a href="cm1-and-cm2.html#cb325-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">consensus =</span> <span class="cn">TRUE</span>,</span>
<span id="cb325-5"><a href="cm1-and-cm2.html#cb325-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">genes =</span> cm2_selected_genes</span>
<span id="cb325-6"><a href="cm1-and-cm2.html#cb325-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning in find_scaffold_genes(scCNA, genes): Genes: TNFRSF6B are in excluded regions of the Varbin pipeline
## and can&#39;t be plotted.</code></pre>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="_main_files/figure-html/cm2_consensus_heatmap-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bm1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="session-info.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/navinlabcode/copykit/blob/master/04-CM1_CM2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
